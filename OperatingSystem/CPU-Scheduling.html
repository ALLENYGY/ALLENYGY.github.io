<!DOCTYPE html>
<html lang="zh">
<head>
  <title>
    
    Cpu Scheduling &middot; AllenYGY的个人小站
    
  </title>
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Cpu Scheduling" />
<meta name="author" content="AllenYGY" />
<meta property="og:locale" content="zh" />
<meta name="description" content="[[CPU-Scheduling]]" />
<meta property="og:description" content="[[CPU-Scheduling]]" />
<link rel="canonical" href="https://allenygy.github.io/OperatingSystem/CPU-Scheduling" />
<meta property="og:url" content="https://allenygy.github.io/OperatingSystem/CPU-Scheduling" />
<meta property="og:site_name" content="AllenYGY的个人小站" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-13T13:40:44+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cpu Scheduling" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"AllenYGY"},"dateModified":"2024-09-13T13:40:44+08:00","datePublished":"2024-09-13T13:40:44+08:00","description":"[[CPU-Scheduling]]","headline":"Cpu Scheduling","mainEntityOfPage":{"@type":"WebPage","@id":"https://allenygy.github.io/OperatingSystem/CPU-Scheduling"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Myicon-0.png"},"name":"AllenYGY"},"url":"https://allenygy.github.io/OperatingSystem/CPU-Scheduling"}</script>
<!-- End Jekyll SEO tag -->

  
  
  <script>
  (n=>{"use strict";let r,s,e;const l=["cdn.jsdelivr.net","fastly.jsdelivr.net","gcore.jsdelivr.net","cdn.zenless.top","testingcf.jsdelivr.net","test1.jsdelivr.net"],t="//",a=l[0],i=Date.now(),o=2e3,c="jsdelivr-auto-fallback",f="/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?",d=e=>e&&e.includes(t+a),m=e=>e.replace(t+a,t+r),u=window.setTimeout,v=n.querySelectorAll.bind(n),g=()=>{let e,t;for(e of v('link[rel="stylesheet"]'))t=e.href,d(t)&&!t.includes(f)&&(e.href=m(t));for(e of v("script"))if(t=e.src,d(t)){const r=n.createElement("script");r.src=m(t),e.defer=!0,e.src="",e.before(r),e.remove()}for(e of v("img"))t=e.src,d(t)&&(e.src="",e.src=m(t));for(e of v("*[style]"))t=e.getAttribute("style"),d(t)&&e.setAttribute("style",m(t));for(e of v("style"))t=e.innerHTML,d(t)&&(e.innerHTML=m(t))},y=()=>{!e&&s&&r&&(console.warn(a+" is not available. Use "+r),e=!0,u(g,0),u(g,20),setInterval(g,500))},b=(()=>{try{return Object.assign({},JSON.parse(localStorage.getItem(c)||"{}"))}catch{return{}}})();var h=()=>{b.time=i,b.failed=!1,b.fastNode=null;for(const t of l)((e,t)=>{let r;const s=n.createElement("link"),l=e=>{r&&(clearTimeout(r),r=0,e||(s.href="data:text/plain;base64,"),s.remove(),t(e))};r=u(l,o),s.addEventListener("error",()=>l(!1)),s.addEventListener("load",()=>l(!0)),s.rel="stylesheet",s.text="text/css",s.href=e+f+i,n.head.insertAdjacentElement("afterbegin",s)})("https://"+t,e=>{e||t!==a||(s=!0,b.failed=!0),e&&!r&&(r=t),e&&!b.fastNode&&(b.fastNode=t),y()});u(()=>{s&&!r&&(r=l[1],y()),localStorage.setItem(c,JSON.stringify(b))},o+100)};b.time&&i-b.time<36e5&&b.failed&&b.fastNode?(s=!0,r=b.fastNode,y(),u(h,1e3)):h()})(document);
</script>

  
  <style>
  .theme-base-07 {
    --theme-base-color: darkslateblue;
  }
</style>

  
  <meta
  name="viewport"
  content="width=device-width,minimum-scale=1,initial-scale=1"
/>
<meta
  http-equiv="content-type"
  content="text/html; charset=utf-8"
/>
<meta 
  name="referrer"
  content="no-referrer" 
/>
<link
  rel="alternate"
  href="/feed.xml"
  title="RSS"
  type="application/rss+xml"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/combine/gh/poole/lanyon@v1.1.0/public/css/poole.min.css,gh/poole/lanyon@v1.1.0/public/css/lanyon.min.css,gh/poole/lanyon@v1.1.0/public/css/syntax.min.css"
/>
<link 
  rel="stylesheet" 
  href="/styles.css"
/>

  
  <link
  rel="apple-touch-icon-precomposed"
  href="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Logo-4.png"
/>
<link
  rel="shortcut
  icon"
  href="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Logo-4.png"
/>

  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"
/>

  
  <style>
  .sidebar, html, h1, h2, h3, h4, h5, h6, code, pre {
    font-family:'MiSans';
  }
</style>

  
</head>

<body
  class="theme-base-0d layout-reverse sidebar-overlay">
  
  
  
  
  <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"  />
  
  <div class="sidebar" id="sidebar">
    
    <div class="sidebar-item">
      <div class="effect effect-right_to_left">
        <img class="effect-img" src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Myicon-0.png" alt="img" />
        <div class="effect-info">
          <br>
<br>
轻阴阁小雨，
<a href="mailto:allenygy@outlook.com">
  <i class="fa-solid fa-envelope fa-fw"></i>
</a>
<br/>
深院昼慵开。
<a href="https://github.com/ALLENYGY">
  <i class="fa-brands fa-github fa-fw"></i>
</a>
<br/>
坐看苍苔色，
<a href="https://allenygy.github.io">
  <i class="fa-solid fa-otter fa-fw"></i>
</a>
<br/>
欲上人衣来。
<a href="https://allenygy.github.io">
  <i class="fa-brands fa-bilibili" fa-fw></i>
</a>

        </div>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      
      <a class="sidebar-nav-item" href="/">
        <i class="fa-solid fa-home fa-fw"></i> 首页
      </a>
      
      <a class="sidebar-nav-item" href="/contents">
        <i class="fa-solid fa-book fa-fw"></i> 目录
      </a>
      
      <a class="sidebar-nav-item" href="/OS">
        <i class="fa-solid fa-laptop fa-fw"></i> 操作系统
      </a>
      
      <a class="sidebar-nav-item" href="/DCN">
        <i class="fa-solid fa-network-wired"></i> 计算机网络
      </a>
      
      <a class="sidebar-nav-item" href="/CO">
        <i class="fa-solid fa-atom fa-fw"></i> 计算机组成原理
      </a>
      
      <a class="sidebar-nav-item" href="/Program">
        <i class="fa-solid fa-code fa-fw"></i> 编程语言
      </a>
      
      <a class="sidebar-nav-item" href="/Math">
        <i class="fa-solid fa-tools fa-fw"></i> 数学
      </a>
      
      <a class="sidebar-nav-item" href="/DBM">
        <i class="fa-solid fa-database fa-fw"></i> 数据库
      </a>
      
      <a class="sidebar-nav-item" href="/Tools">
        <i class="fa-solid fa-tools fa-fw"></i> 编程素养
      </a>
      
      <a class="sidebar-nav-item" href="/archive">
        <i class="fa-solid fa-archive fa-fw"></i> 归档
      </a>
      
      <a class="sidebar-nav-item" href="/tags">
        <i class="fa-solid fa-tags fa-fw"></i> 标签
      </a>
      
      <a class="sidebar-nav-item" href="/map">
        <i class="fa-solid fa-circle-nodes fa-fw"></i> 图谱
      </a>
      
      <a class="sidebar-nav-item" href="/links">
        <i class="fa-solid fa-user-friends fa-fw"></i> 友链
      </a>
      
    </nav>
    <div class="sidebar-item">
      
      <input
  id="sidebar-search-input"
  placeholder="搜索博文"
/>
<ol
  id="sidebar-search-results-container"
></ol>
<script
  src='https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.9.1'
  async='async'
  onload='
    SimpleJekyllSearch({
      json: "/assets/simple-jekyll-search/search.json",
      searchInput: document.getElementById("sidebar-search-input"),
      resultsContainer: document.getElementById("sidebar-search-results-container"),
      searchResultTemplate: `<li><a href="{url}">{title}</a></li>`,
      limit: 99,
      fuzzy: true
    })'
></script>

      
      
      <ol id="toc">
  <li><a href="#cpu-scheduling">CPU-Scheduling</a>
    <ol>
      <li><a href="#basic-concept">Basic Concept</a></li>
      <li><a href="#cpu-scheduler-cpu%E8%B0%83%E5%BA%A6%E7%A8%8B%E5%BA%8F">CPU Scheduler CPU调度程序</a></li>
      <li><a href="#scheduling-criteria">Scheduling Criteria</a></li>
      <li><a href="#scheduling-algorithm">Scheduling Algorithm</a>
        <ol>
          <li><a href="#first-come-first-served-scheduling-fcfs">First-Come, First-Served Scheduling FCFS</a></li>
          <li><a href="#shortest-job-first-scheduling-sjf">Shortest-Job-First Scheduling SJF</a>
            <ol>
              <li><a href="#determining-length-of-next-cpu-burst-durationpng">Determining Length of Next CPU Burst-duration.png</a></li>
            </ol>
          </li>
          <li><a href="#shortest-remaining-time-first-srtf">Shortest-remaining-time-first SRTF</a></li>
          <li><a href="#round-robin-rr">Round-Robin RR</a></li>
          <li><a href="#priority-scheduling">Priority Scheduling</a></li>
          <li><a href="#multilevel-queue">Multilevel Queue</a></li>
          <li><a href="#multilevel-feedback-queue-mfq">Multilevel Feedback Queue MFQ</a></li>
        </ol>
      </li>
      <li><a href="#thread-scheduling">Thread Scheduling</a></li>
      <li><a href="#multi-process-scheduling">Multi-Process Scheduling</a>
        <ol>
          <li><a href="#symmetric-multiprocessing-smp">Symmetric multiprocessing (SMP)</a></li>
          <li><a href="#multicore-processors">Multicore Processors</a>
            <ol>
              <li><a href="#multithreaded-multicore-system">Multithreaded Multicore System</a></li>
            </ol>
          </li>
          <li><a href="#multiple-processor-scheduling---loading-balancing--%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">Multiple-Processor Scheduling - Loading Balancing —-负载均衡</a></li>
          <li><a href="#multiple-processor-scheduling--processor-affinity-%E5%A4%84%E7%90%86%E5%99%A8%E4%BA%B2%E5%92%8C%E5%8A%9B">Multiple-Processor Scheduling – Processor Affinity 处理器亲和力</a></li>
        </ol>
      </li>
      <li><a href="#numa-and-cpu-scheduling">NUMA and CPU Scheduling</a></li>
      <li><a href="#real-time-cpu-scheduling">Real-Time CPU Scheduling</a>
        <ol>
          <li><a href="#event-latency-%E4%BA%8B%E4%BB%B6%E5%BB%B6%E8%BF%9F">Event Latency 事件延迟</a></li>
          <li><a href="#priority-based-scheduling">Priority-based Scheduling</a>
            <ol>
              <li><a href="#rate-monotonic-scheduling">Rate Monotonic Scheduling</a></li>
              <li><a href="#earliest-deadline-first-scheduling-edf">Earliest Deadline First Scheduling EDF</a></li>
              <li><a href="#proportional-share-scheduling">Proportional Share Scheduling</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#operating-system-examples">Operating System Examples</a>
        <ol>
          <li><a href="#linux-scheduling">Linux Scheduling</a>
            <ol>
              <li><a href="#completely-fair-scheduler-cfs">Completely Fair Scheduler CFS</a></li>
            </ol>
          </li>
          <li><a href="#windows-scheduling">Windows Scheduling</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
      
      
      <script defer="defer" >
 !function (e) {
   var flag = /Android|iPhone|iPad|iPod|BlackBerry|webOS|Windows Phone|SymbianOS|IEMobile|Opera Mini/i.test(navigator.userAgent);
   if (flag) {
      var c = e.querySelector(".sidebar-toggle"),
      r = e.querySelector("#sidebar"),
      t = e.querySelector("#sidebar-checkbox");
      e.addEventListener("click", function (e) {
      var n = e.target;
      t.checked && !r.contains(n) && n !== t && n !== c && (t.checked = !1)
    }, !1)
  } 
}(document);
</script>

      
      <style>
  #sidebar-checkbox:checked ~ .sidebar-toggle,
  .sidebar,
  .sidebar-toggle:active {
    background-color: var(--theme-base-color);
  }
</style>

      
      <div>
  <i class="fa-solid fa-cog fa-spin fa-fw"></i>
  <span id="run_time_day">
  </span>天
  <span id="run_time_hour">
  </span>时
  <span id="run_time_minute">
  </span>分
  <span id="run_time_second">
  </span>秒
  <script>
    setInterval(function (d,h,m,s,b) {
      function setzero(i) {
        return i < 10 ? "0" + i : i;
      }
      let BirthDay = new Date(b);
      let today = new Date();
      let timeold = (today.getTime() - BirthDay.getTime());
      let sectimeold = timeold / 1000;
      let secondsold = Math.floor(sectimeold);
      let msPerDay = 24 * 60 * 60 * 1000;
      let e_daysold = timeold / msPerDay;
      let daysold = Math.floor(e_daysold);
      let e_hrsold = (e_daysold - daysold) * 24;
      let hrsold = Math.floor(e_hrsold);
      let e_minsold = (e_hrsold - hrsold) * 60;
      let minsold = Math.floor((e_hrsold - hrsold) * 60);
      let seconds = Math.floor((e_minsold - minsold) * 60);
      d.textContent = daysold;
      h.textContent = setzero(hrsold);
      m.textContent = setzero(minsold);
      s.textContent = setzero(seconds);
    },
    1000,
    document.getElementById("run_time_day"),
    document.getElementById("run_time_hour"),
    document.getElementById("run_time_minute"),
    document.getElementById("run_time_second"),
    "03/20/2024 16:27:40")
  </script>
</div>

      
      <div>
  <div>
    <i class="fa-solid fa-eye fa-fw"></i>
    <span id="busuanzi_value_page_pv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>次
  </div>
  <div>
    <i class="fa-solid fa-paw fa-fw"></i>
    <span id="busuanzi_value_site_pv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>枚
  </div>
  <div>
    <i class="fa-solid fa-user-friends fa-fw"></i>
    <span id="busuanzi_value_site_uv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>人
  </div>
  <script
    src='https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js'
    async='async'
  ></script>
</div>

      
      <div>
  <i class="fa-solid fa-thumbs-up fa-fw"></i>
  <a href="https://github.com/ALLENYGY/jekyll-theme-ObJekyll">
    theme-ObJekyll
  </a>
</div>

      
      <div>
  <i class="fa-solid fa-copyright fa-fw"></i>
  2024 ALLENYGY
</div>

      
      
      <div>
        <i class="fa-solid fa-user-edit fa-fw"></i>
        
        
        
        47万
        
          
        
        6千
        775字
        
      </div>
      
    </div>
  </div>
  
  
  <div class="wrap">
    
    
    
    
<style>
  h1::before,
  h2::before,
  h3::before,
  h4::before,
  h5::before,
  h6::before {
    font-family: "Font Awesome 6 Free";
    font-weight: bold;
    font-size: smaller;
    margin-right: .5rem;
    content: "\f292";
  }
</style>



<div class="container content">
  <div class="page">
    
    <h1 class="page-title">Cpu Scheduling</h1>
    
    <div class="wrapper">
    <main><div class="post">
    <span class="post-date">
        
        <i class="fa-solid fa-calendar-day fa-fw"></i>
        改于：2024-04-11 16:11:00 Thursday
        <br>
        
        
        <i class="fa-solid fa-calendar-plus fa-fw"></i>
        建于：2024-03-20 22:56:00 Wednesday
        
        
        <i class="fa-solid fa-file-word fa-fw"></i>
        15334字
        
        
        <i class="fa-solid fa-clock fa-fw"></i>
        52分
        
        
        
        <br>
        
        OS, NOTE, and Lec5
        
        
        <br/>
<i class="fab fa-creative-commons-by fa-fw"></i>
<a
  href="https://creativecommons.org/licenses/by/4.0/deed.zh"
  rel="license">
  CC BY 4.0（除特别声明或转载）
</a>

        
    </span>
    <div id="notes-entry-container">
        <content>
            <h1 id="cpu-scheduling"><a class="internal-link" href="/OperatingSystem/CPU-Scheduling">CPU-Scheduling</a></h1>

<h2 id="basic-concept">Basic Concept</h2>

<p>To maximize CPU utilization
Using Multiprogramming</p>

<blockquote>
  <p>[!info]+ CPU-I/O Burst Cycle</p>
  <ul>
    <li>Process execution consists of a cycle of CPU execution and I/O wait</li>
    <li>CPU burst followed by I/O burst</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Burst-duration.png" alt="Burst-Duration" /></li>
    <li>横轴表示CPU Burst时间</li>
  </ul>
</blockquote>

<blockquote>
  <ul>
    <li><strong>短CPU突发</strong>：大多数进程都会有大量的短时间CPU突发，这表示进程在执行较短时间的计算后就会等待I/O操作。</li>
    <li><strong>长CPU突发</strong>：只有少数进程会有较长时间的CPU突发，这些通常是计算密集型的进程，在执行更长时间的计算之后才会进行I/O操作。</li>
  </ul>
</blockquote>

<h2 id="cpu-scheduler-cpu调度程序">CPU Scheduler <code class="language-plaintext highlighter-rouge">CPU调度程序</code></h2>

<blockquote>
  <p>[!quote]+ The CPU scheduler selects a process from the processes in ready queue , and allocates the CPU to it</p>
  <ul>
    <li>Ready queue <code class="language-plaintext highlighter-rouge">就绪队列</code> may be ordered in various ways</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!question]+ When does the CPU Scheduling  happen ？</p>
  <ol>
    <li>switches from running to waiting state (non-preemptive<code class="language-plaintext highlighter-rouge">自愿</code> )
      <ul>
        <li>Example: the process does an I/O system call.</li>
      </ul>
    </li>
    <li>switches from running to ready state (preemptive <code class="language-plaintext highlighter-rouge">非自愿</code>)
      <ul>
        <li>Example: there is a clock interrupt.</li>
      </ul>
    </li>
    <li>switches from waiting to ready (preemptive)
      <ul>
        <li>Example: there is a hard disk controller interrupt because the I/O is finished.</li>
      </ul>
    </li>
    <li>terminates (non-preemptive)</li>
  </ol>
</blockquote>

<blockquote>
  <p>[!abstract]+ Preemptive vs. Nonpreemptive Scheduling</p>
  <ul>
    <li>When a process is pre-empted, <code class="language-plaintext highlighter-rouge">当进程非自愿离开CPU</code>
 	- It is moved from its current processor
 	- However, it still remains in memory and in ready queue <code class="language-plaintext highlighter-rouge">仍保留在就绪队列</code></li>
    <li>When a process is non-preemptive <code class="language-plaintext highlighter-rouge">当进程自愿离开CPU</code>
      <ul>
        <li>Process runs until completion or until they yield control of a processor <code class="language-plaintext highlighter-rouge">进程运行直至完成或让出处理器控制权</code></li>
        <li>Disadvantage: Unimportant processes can block important ones indefinitely
          <ul>
            <li><code class="language-plaintext highlighter-rouge">进程易阻塞</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!question]+ Why preemptive scheduling is used?</p>
  <ul>
    <li>Improve response times</li>
    <li>Create interactive environments (real-time)</li>
  </ul>
</blockquote>

<h2 id="scheduling-criteria">Scheduling Criteria</h2>
<blockquote>
  <p>[!info]+ Concept</p>
  <ul>
    <li><strong>Throughput</strong>: number of processes that complete their execution per time unit<code class="language-plaintext highlighter-rouge">吞吐量</code></li>
    <li><strong>Response Time</strong>: amount of time it takes from when a request was submitted until the first response is produced, not output (for time-sharing environment) <code class="language-plaintext highlighter-rouge">等待时间-进程在就绪队列中等待的总时间</code></li>
    <li><strong>Turnaround Time</strong>: amount of time to execute a particular process (from start to end of process, including waiting time) <code class="language-plaintext highlighter-rouge">执行特定流程的时间(从流程的开始到结束，包括等待时间)</code>
      <ul>
        <li>Turnaround Time = Waiting time + time for all CPU bursts</li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!info]+ Scheduling Criteria</p>
  <ul>
    <li><em>Maximize</em>
      <ul>
        <li><strong>CPU Utilization</strong>^[keep the CPU as busy as possible]</li>
        <li><strong>Throughput</strong>^[Increase throughput as high as possible]</li>
      </ul>
    </li>
    <li><em>Minimize</em>
      <ul>
        <li><strong>Response time</strong></li>
        <li><strong>Waiting time</strong></li>
        <li><strong>Turnaround time</strong></li>
      </ul>
    </li>
  </ul>
</blockquote>

<h2 id="scheduling-algorithm">Scheduling Algorithm</h2>

<blockquote>
  <p>[!abstract]+ Scheduling Algorithm</p>
  <ol>
    <li>
      <p>First-Come, First-Served <code class="language-plaintext highlighter-rouge">FCFS</code></p>
    </li>
    <li>
      <p>Shortest-Job-First <code class="language-plaintext highlighter-rouge">SJF</code></p>
    </li>
    <li>
      <p>Priority Scheduling <code class="language-plaintext highlighter-rouge">PS</code></p>
    </li>
    <li>
      <p>Round-Robin <code class="language-plaintext highlighter-rouge">RR</code></p>
    </li>
    <li>
      <p>Multilevel Queue Scheduling <code class="language-plaintext highlighter-rouge">MQS</code></p>
    </li>
    <li>
      <p>Multilevel Feedback Queue Scheduling <code class="language-plaintext highlighter-rouge">MFQS</code></p>
    </li>
  </ol>
</blockquote>

<h3 id="first-come-first-served-scheduling-fcfs">First-Come, First-Served Scheduling <code class="language-plaintext highlighter-rouge">FCFS</code></h3>

<blockquote>
  <p>[!tip]+ Scheduling</p>
  <ul>
    <li>Suppose that the processes arrive in the ready queue at time $t = 0$ in the following order: $P_1, P_2, P_3$</li>
  </ul>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Burst Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">24</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ FCFS Example</p>
  <ul>
    <li>The Gantt Chart for the schedule is:</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/GanttChart.png" alt="Gantt Schedule" /></li>
    <li>Waiting time: $P_1= 0; P_2= 24; P_3= 27$</li>
    <li>Average waiting time: $\frac{0 + 24 + 27}{3} = 17$</li>
    <li>Average turnaround time:  $\frac{24+27+30}{3} = 27$</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!example]+ Change Example
Suppose the order is changed to this $P_2, P_3, P_1$</p>
  <ul>
    <li>The Gantt Chart for the schedule is:</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/GanttChart-1.png" alt="GanttChart-1" /></li>
    <li>Waiting time: $P_1= 6; P_2= 0; P_3= 3$</li>
    <li>Average waiting time: $\frac{6 + 0 + 3}{3} = 3$</li>
    <li>Average turnaround time:  $\frac{30+6+3}{3} = 13$</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]+ Convoy effect<code class="language-plaintext highlighter-rouge">护送效应</code> - short process behind long process</p>
</blockquote>

<h3 id="shortest-job-first-scheduling-sjf">Shortest-Job-First Scheduling <code class="language-plaintext highlighter-rouge">SJF</code></h3>

<blockquote>
  <p>[!tip]+ Scheduling</p>
  <ul>
    <li>SJF is optimal – gives minimum average waiting time for a given set of processes</li>
    <li>The difficulty is knowing the length of the next CPU request  Could ask the user</li>
  </ul>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Burst Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">8</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">7</td>
    </tr>
    <tr>
      <td style="text-align: center">P4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ SJF Example</p>
  <ul>
    <li>The Gantt Chart for the schedule is:</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/GanttChart-2.png" alt="GanttChart-2" /></li>
    <li>Average waiting time = $\frac{3 + 16 + 9 + 0}{4} = 7$</li>
    <li>Average turnaround time = $\frac{3+9+16+24}{4} = 13$</li>
  </ul>
</blockquote>

<h4 id="determining-length-of-next-cpu-burst-durationpng">Determining Length of Next CPU Burst-duration.png</h4>

<blockquote>
  <p>[!info]+ Estimation Method
Use the length of previous CPU bursts, with exponential averaging
$\tau_{n+1} = \alpha \times t_n + (1 - \alpha) \times \tau_n$</p>
  <ul>
    <li>$\tau_{n+1}$ 是对下一个CPU突发的预测时间。</li>
    <li>$t_n$ 是第n个CPU突发的实际长度。</li>
    <li>$\tau_n$ 是第n个CPU突发的预测时间（基于过去的观测）。</li>
    <li>$\alpha$ 是一个介于0和1之间的权重，用来平衡最近的实际CPU突发时间和之前的预测。
$\tau_{n+1} = \alpha t_n + (1 - \alpha)\alpha t_{n-1} + \ldots + (1 - \alpha)^j \alpha t_{n-j} + \ldots + (1 - \alpha)^{n+1} \tau_0$</li>
  </ul>
</blockquote>

<h3 id="shortest-remaining-time-first-srtf">Shortest-remaining-time-first <code class="language-plaintext highlighter-rouge">SRTF</code></h3>

<blockquote>
  <p>[!tip]+ Scheduling Algorithm
The preemptive version of SJF is also called shortest-remaining-time-first</p>
  <ul>
    <li><strong>Preemption</strong>: If a new process arrives in the ready queue while a current process is executing, the remaining time to complete the current process is compared with the total time required by the new process to finish. If the new process requires less time than what the current process has left, the current process is preempted (put back in the ready queue) and the CPU is given to the new process.</li>
    <li><strong>Efficiency</strong>: This algorithm is effective in terms of average waiting time and turnaround time. By giving preference to processes that are closest to completion, it minimizes the amount of time each process has to wait to complete its execution.</li>
    <li><strong>Starvation</strong>: A potential downside of SRTF is that longer processes may suffer starvation; if shorter processes keep arriving, the longer processes may be postponed indefinitely.</li>
    <li><strong>Dynamic</strong>: Unlike SJF, which is static and decides on a process before it starts executing, SRTF has to make decisions dynamically as new processes arrive and as the remaining execution times of the processes in the ready queue change.</li>
  </ul>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Arrival Time</th>
      <th style="text-align: right">Burst Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">0</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">2</td>
      <td style="text-align: right">9</td>
    </tr>
    <tr>
      <td style="text-align: center">P4</td>
      <td style="text-align: center">4</td>
      <td style="text-align: right">5</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ SRTF Example</p>
  <ul>
    <li>The Gantt Chart for the schedule is:</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Gantt-Chart-3.png" alt="GanttChart-3" /></li>
    <li>Average waiting time = $\frac{(10-1) + (1-1) + (17-2) + (5-3)}{4} = \frac{26}{4}=6.5$</li>
    <li>Average turnaround time = $\frac{(17-0)+(5-1)+(26-2)+(10-3)}{4} = 13$</li>
  </ul>
</blockquote>

<h3 id="round-robin-rr">Round-Robin <code class="language-plaintext highlighter-rouge">RR</code></h3>

<blockquote>
  <p>[!info]+ Scheduling Algorithm</p>
  <ul>
    <li>Each process gets a small unit of CPU time (time quantum <code class="language-plaintext highlighter-rouge">定额</code>, usually 10-100 milliseconds.</li>
    <li>After q has elapsed, the process is preempted by a clock interrupt and added to the end of the ready queue.</li>
    <li>Timer interrupts every quantum q to schedule next process</li>
    <li>If there are n processes in the ready queue and the time quantum is q. No process waits more than $(n-1)*q$</li>
    <li>Performance
      <ul>
        <li>q too large $\rightarrow$  FCFS</li>
        <li>q too small  $\rightarrow$ too much time is spent on context switch
          <ul>
            <li>q should be large compared to context switch time</li>
            <li>q usually 10ms to 100ms, context switch &lt; 10 usec (微秒)</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Burst Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">24</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ SRTF
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Gantt-Chart-4.png" alt="GanttChart-4" /></p>
  <ul>
    <li>Average waiting time: $\frac{6 + 4 + 7}{3} = 5.67$</li>
    <li>Average turnaround time:  $\frac{30+7+10}{3} = 15.7$</li>
  </ul>
</blockquote>

<h3 id="priority-scheduling">Priority Scheduling</h3>

<p>The CPU is allocated to the process with the highest priority 
(smallest integer $\Leftrightarrow$ highest priority)</p>

<blockquote>
  <p>[!info]+ Two policies</p>
  <ul>
    <li>Preemptive
      <ul>
        <li>the current process is pre-empted immediately by high priority process</li>
      </ul>
    </li>
    <li>Non-preemptive 
  -the current process finishes its burst first, then scheduler chooses the process with highest priority</li>
  </ul>

  <p>SJF is priority scheduling where priority is the inverse of predicted next CPU burst time</p>
</blockquote>

<blockquote>
  <p>[!question]+ What is the Problem in Proority Scheduling ?</p>
  <ul>
    <li>Problem: Starvation: low priority processes may never execute</li>
    <li>Solution: Aging: as time progresses increase the priority of the process</li>
  </ul>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Burst Time</th>
      <th style="text-align: center">Priority</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">10</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">P5</td>
      <td style="text-align: center">5</td>
      <td style="text-align: center">2</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ Priority Scheduling (not preemptive)
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Gantt-Chart-5.png" alt="GanttChart-5 " />
Average waiting time = $\frac{6+0+16+18+1}{5} = 8.2$</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Process</th>
      <th style="text-align: center">Burst Time</th>
      <th style="text-align: center">Priority</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">P1</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">P2</td>
      <td style="text-align: center">5</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">P3</td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">P5</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!example]+ Priority Scheduling  $Assume q=2$
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Gantt-Chart-6.png" alt="Gantt-Chart-6" />
Average waiting time = $\frac{22+11+12+0+24}{5} = 13.8$</p>
</blockquote>

<h3 id="multilevel-queue">Multilevel Queue</h3>

<blockquote>
  <p>[!info]+ Multilevel Queue</p>
  <ul>
    <li>Ready queue is partitioned into separate queues, e.g.:
      <ul>
        <li>Foreground (interactive processes)</li>
        <li>Background (batch processes)</li>
      </ul>
    </li>
    <li>Process permanently in a given queue (stay in that queue) Each queue has its own scheduling algorithm:
      <ul>
        <li>Foreground – RR</li>
        <li>Background – FCFS</li>
      </ul>
    </li>
    <li>Scheduling must be done between the queues:
      <ul>
        <li>Fixed priority scheduling
          <ul>
            <li>Each queue has a given priority
              <ul>
                <li>High priority queue is served before low priority queue</li>
                <li>Possibility of starvation</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>Time slice
          <ul>
            <li>Each queue gets a certain amount of CPU time</li>
          </ul>
        </li>
      </ul>
    </li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/MultilevelQueuePriority.png" alt="MultilevelQueuePriority" /></li>
  </ul>
</blockquote>

<h3 id="multilevel-feedback-queue-mfq">Multilevel Feedback Queue <code class="language-plaintext highlighter-rouge">MFQ</code></h3>

<blockquote>
  <p>[!info]+ Multilevel Feedback Queue</p>
  <ul>
    <li>A process can move between the various queues;
      <ul>
        <li>aging can be considered in this way (prevent starvation)</li>
        <li>advantage: prevent</li>
      </ul>
    </li>
    <li>The multilevel feedback queue scheduler
      <ul>
        <li>the most general CPU scheduling algorithm</li>
        <li>defined by the following parameters:
          <ol>
            <li>number of queues</li>
            <li>scheduling algorithms for each queue</li>
            <li>Policies on moving process between queues
              <ol>
                <li>when to upgrade a processes</li>
                <li>when to demote <code class="language-plaintext highlighter-rouge">降级</code> a processes</li>
                <li>which queue a process will enter when that process needs service</li>
              </ol>
            </li>
          </ol>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!example]+ Example of Multilevel Feedback Queue
Three queues: FCFS+RR</p>
  <ol>
    <li>$Q_0$ – RR with time quantum 8 milliseconds</li>
    <li>$Q_1$ – RR with time quantum 16 milliseconds</li>
    <li>$Q_2$ – FCFS
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Example-MFQ.png" alt="MFQ" /></li>
  </ol>
</blockquote>

<blockquote>
  <p>[!tip]+ Scheduling</p>
  <ul>
    <li>A new job enters queue $Q_0$ which is served FCFS</li>
    <li>When it gains CPU, job receives 8 milliseconds</li>
    <li>If it does not finish in 8 milliseconds, job is moved to queue $Q_1$</li>
    <li>At $Q_1$ job is again served FCFS and receives 16 additional milliseconds</li>
    <li>If it still does not complete, it is preempted and moved to queue $Q_2$ where it runs until completion but with a low priority</li>
  </ul>
</blockquote>

<h2 id="thread-scheduling">Thread Scheduling</h2>

<p>Distinguish between user-level and kernel-level threads</p>
<ul>
  <li>When threads are supported by kernel,   threads are scheduled, not processes 
<code class="language-plaintext highlighter-rouge">当内核支持线程时，内核调度的是线程，而不是进程</code>
    <blockquote>
      <p>[!example]+ 
Many-to-one and many-to-many models,</p>
      <ul>
        <li>Thread library schedules user-level threads to run on kernel threads (LWP: light-weight process)</li>
      </ul>

      <p>Typically priority is set by programmer <code class="language-plaintext highlighter-rouge">优先级人为设置</code></p>
    </blockquote>
  </li>
  <li>Kernel threads are scheduled by Kernel onto available CPU <code class="language-plaintext highlighter-rouge">内核线程被可利用的CPU调度</code>
    <ul>
      <li>system-contention scope <code class="language-plaintext highlighter-rouge">SCS</code></li>
      <li>competition is among all kernel-level threads from all processes in the system</li>
    </ul>
  </li>
  <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/ThreadScheduling-1.png" alt="ThreadScheduling-1" /></li>
  <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/ThreadScheduling-2.png" alt="ThreadScheduling-2" /></li>
</ul>

<h2 id="multi-process-scheduling">Multi-Process Scheduling</h2>

<p>The term Multiprocessor now applies to the following system architectures:</p>

<ul>
  <li>Multicore CPUs</li>
  <li>Multithreaded cores</li>
  <li>NUMA systems</li>
</ul>

<h3 id="symmetric-multiprocessing-smp">Symmetric multiprocessing (SMP)</h3>

<p>Symmetric multiprocessing (SMP) is where each processor is self scheduling</p>
<blockquote>
  <p>[!abstract]+ Two Scheduling Method</p>
  <ol>
    <li>All threads may be in a common ready queue (a) <code class="language-plaintext highlighter-rouge">所有进程共用一个就绪队列</code></li>
    <li>Each processor may have its own private queue of threads（b）<code class="language-plaintext highlighter-rouge">每个处理机都有私有的队列</code>
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/SMP.png" alt="SMP" /></li>
  </ol>
</blockquote>

<h3 id="multicore-processors">Multicore Processors</h3>

<p>When multiple processor cores are on same physical chip —-》 Multicore Processor</p>
<ul>
  <li>Multicore Processor ==&gt; Recent trend</li>
</ul>

<blockquote>
  <p>[!success]+ Advantage
 Faster and consumes less power</p>
</blockquote>

<blockquote>
  <p>[!failure]+ Disadvantage
Memory Stall Growing^[An event that occurs when a thread is on CPU and accesses memory content that is not in the CPU’s cache. The thread’s execution stalls while the memory content is retrieved and fetched]</p>
</blockquote>

<p>Solution： 每个核都有多个硬件线程</p>
<ul>
  <li>Each core has more than one hardware threads. If one thread has a memory stall, switch to another thread!</li>
</ul>

<h4 id="multithreaded-multicore-system">Multithreaded Multicore System</h4>

<p><em>Chip-multithreading</em>  <code class="language-plaintext highlighter-rouge">CMT</code> assigns each core multiple hardware threads.</p>
<ul>
  <li>(Intel refers to this as hyper-threading.)</li>
</ul>

<p>On a quad-core system (4核) with 2 hardware threads per core, the operating system sees 8 logical processors.</p>

<blockquote>
  <p>[!abstract]- 
在一个四核（4核）系统中，如果每个核心支持2个硬件线程，操作系统看到的8个逻辑处理器其实是由这种硬件线程技术（也称为超线程技术）使得每个物理核心能够同时处理两个线程。这种技术允许CPU更高效地利用其资源，特别是在某些核心的一部分资源（如执行单元）在特定时刻未被充分使用时。
具体来说，超线程技术通过使每个物理核心在操作系统层面呈现为两个逻辑处理器来工作。这样，操作系统和应用程序可以将这些逻辑处理器视为独立的处理单元，从而在逻辑上扩展了CPU的并行处理能力。
因此，在这样一个四核处理器中，由于每个核心可以处理两个线程，总共就有(4 \times 2 = 8)个逻辑处理器。这就是操作系统为什么会看到8个逻辑处理器的原因。这种安排使得处理器在处理多任务或多线程应用程序时更为高效，尤其是在等待I/O操作或进行其他非CPU密集型任务时，可以更好地利用CPU资源。</p>
</blockquote>

<p>Two levels of scheduling: <code class="language-plaintext highlighter-rouge">可以在两个层次调度</code> Multithreaded Multicore System</p>
<ol>
  <li>The operating system deciding which software thread to run on a logical CPU <code class="language-plaintext highlighter-rouge">OS决定谁进CPU(逻辑上)</code></li>
  <li>Each core decides which hardware thread to run on the physical core <code class="language-plaintext highlighter-rouge">Core 决定谁进入物理核心</code></li>
</ol>

<h3 id="multiple-processor-scheduling---loading-balancing--负载均衡">Multiple-Processor Scheduling - Loading Balancing —-<code class="language-plaintext highlighter-rouge">负载均衡</code></h3>

<blockquote>
  <p>[!info]+ Load balancing
Load balancing attempts to keep workload evenly distributed</p>
  <ul>
    <li><strong>Push migration</strong> – periodic task checks load on each processor, and pushes tasks from overloaded CPU to other less loaded CPUs</li>
    <li><strong>Pull migration</strong> – idle CPUs pulls waiting tasks from busy CPU</li>
  </ul>
</blockquote>

<p>**Push and pull migration need not be mutually exclusive ** <code class="language-plaintext highlighter-rouge">推迁移、拉迁移不必相互互斥</code></p>
<ul>
  <li>They are often implemented in parallel on load-balancing systems.</li>
</ul>

<h3 id="multiple-processor-scheduling--processor-affinity-处理器亲和力">Multiple-Processor Scheduling – Processor Affinity <code class="language-plaintext highlighter-rouge">处理器亲和力</code></h3>

<p><strong>处理器亲和性指的是线程或进程倾向于在被分配运行的同一个CPU上运行的性质。</strong> 当线程在一个处理器上运行时，它的数据会被存储在该处理器的高速缓存（cache）中。如果这个线程之后继续在同一个处理器上运行，它可以更快地访问之前的数据，因为数据已经在缓存中了。</p>

<p><strong>Load balancing</strong> may affect <strong>processor affinity</strong></p>
<ul>
  <li>A thread may be moved from one processor to another to balance loads</li>
  <li>
    <p>That thread loses the contents of what it had in the cache of the processor it was moved off</p>
  </li>
  <li>
    <p><strong>Soft affinity</strong><code class="language-plaintext highlighter-rouge">软亲和性</code>：操作系统会尽量让线程在同一个处理器上运行，但不保证。系统负载均衡器可能会根据需要将线程迁移到其他处理器。</p>
  </li>
  <li><strong>Hard affinity</strong><code class="language-plaintext highlighter-rouge">应亲和性</code>：进程可以指定它希望运行的处理器集合。如果设置了硬亲和性，即使在负载高的情况下，内核也不会将进程移动到它未指定运行的处理器上。</li>
</ul>

<h2 id="numa-and-cpu-scheduling">NUMA and CPU Scheduling</h2>

<blockquote>
  <p>[!info]+ NUMA and CPU Scheduling
在NUMA架构中，计算机的内存被分割成多个区域，每个CPU都有一块局部内存。这些内存区域之间的访问速度可能不一样： 
<strong>局部内存（Local memory）</strong>：与某个CPU相邻的内存，这个CPU访问局部内存的速度快（fast access）。 
<strong>非局部内存（Non-local memory）</strong>：不与该CPU相邻的内存，该CPU访问非局部内存的速度慢（slow access）。
NUMA-aware操作系统在调度线程到CPU时会考虑内存访问的非一致性。它会尝试将线程分配到可以快速访问所需数据的CPU上。这意味着操作系统会考虑线程正在使用的数据的内存位置，并尽量让线程在靠近这些数据的CPU上运行。
这样做的好处是减少了内存访问延迟，提高了处理速度。但是，如果线程被调度到远离其数据的CPU上，它访问内存的速度将会慢下来，这可能会降低性能。
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/NUMA-CPU-Scheduling.png" alt="NUMA-CPU-Scheduling" /></p>
</blockquote>

<h2 id="real-time-cpu-scheduling">Real-Time CPU Scheduling</h2>

<blockquote>
  <p>[!question]+ Why Real-Time CPU Scheduling? 
  实时CPU调度（Real-Time CPU Scheduling）是一种操作系统的调度机制，它确保能够满足实时任务的时间要求。实时操作系统（RTOS）通常需要这种调度策略，因为它们运行着要求在特定时间内完成或响应的任务。</p>
</blockquote>

<blockquote>
  <p>[!info]+ Two kinds of RTOS</p>
  <ul>
    <li>Soft real-time systems <code class="language-plaintext highlighter-rouge">尽可能在截止时间内完成任务</code>
      <ul>
        <li>Critical real-time tasks have the highest priority, but no guarantee as to when tasks will be scheduled (best try only)</li>
      </ul>
    </li>
    <li>Hard real-time systems <code class="language-plaintext highlighter-rouge">严格在截止时间前完成任务</code>
      <ul>
        <li>a task must be serviced by its deadline (guarantee)</li>
      </ul>
    </li>
  </ul>
</blockquote>

<h3 id="event-latency-事件延迟">Event Latency <code class="language-plaintext highlighter-rouge">事件延迟</code></h3>

<blockquote>
  <p>[!info]+ Event latency</p>
  <ul>
    <li>the amount of time that elapses from when an event occurs to when it is serviced.</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!abstract]+ Two kinds of Event Latency</p>
  <ol>
    <li>Interrupt latency <code class="language-plaintext highlighter-rouge">中断延迟</code>– time from arrival of interrupt to start of kernel interrupt service routine (ISR) that services interrupt
      <ul>
        <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/InterruptLatency.png" alt="Interrupt Latency" /></li>
      </ul>
    </li>
    <li>Dispatch latency <code class="language-plaintext highlighter-rouge">调度延迟</code> – time for scheduler to take current process off CPU and switch to another
      <ul>
        <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/DispatchLatency.png" alt="Dispatch Latency" /></li>
      </ul>
    </li>
  </ol>
</blockquote>

<h3 id="priority-based-scheduling">Priority-based Scheduling</h3>

<blockquote>
  <p>[!quote]+ For real-time scheduling, scheduler must support preemptive, priority-based scheduling</p>
  <ul>
    <li>But only guarantees soft real-time</li>
    <li>For hard real-time, must also provide ability to meet deadlines</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!info]+ Process need new Characteristic
<strong>New Characteristic</strong>: periodically require CPU at constant intervals</p>
  <ul>
    <li><strong>Process Time</strong> $t$^[处理时间]: 进程需要CPU的时间</li>
    <li><strong>Deadline</strong> $d$^[截止时间]: 进程必须完成其任务的最后期限</li>
    <li><strong>Period</strong> $p$^[周期时间]: 进程每隔一定时间就需要运行的周期。</li>
    <li><strong>Rate of period task</strong>^[周期任务的频率]: $\frac{1}{p}$</li>
    <li>Relation: $0\leq t\leq d\leq p$</li>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/PriorityBasedScheduling.png" alt="PriorityBasedScheduling" /></li>
  </ul>
</blockquote>

<h4 id="rate-monotonic-scheduling">Rate Monotonic Scheduling</h4>

<p><strong>Priority is assigned based on the inverse of its period</strong></p>

<p>\(Shorter\ periods\ =\ higher\ priority\)
\(Longer\ periods\ = lower\  priority\)</p>

<blockquote>
  <p>[!example]+ Example of Rate Monotonic Scheduling
Asume Priority : $P_1 &gt;P_2$
 $P_1$ needs to run for 20 ms every 50 ms. 
 	- $t = 20, d = p = 50$
$P_2$ needs to run for 35 ms every 100 ms. 
	- $t = 35, d = p = 100$
Assume deadline $d = p$
假定每个任务的截止时间<code class="language-plaintext highlighter-rouge">d</code>等于其周期<code class="language-plaintext highlighter-rouge">p</code>，即每个任务必须在下一个周期开始之前完成。
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/RateMonotonicScheduling.png" alt="RateMonotonicScheduling" /></p>
</blockquote>

<blockquote>
  <p>[!example]+ Missed Deadlines Case
 $P_1$ needs to run for 25 ms every 50 ms. 
 	- $t = 25, d = p = 50$
$P_2$ needs to run for 35 ms every 80 ms. 
	- $t = 35, d = p = 80$</p>
  <ul>
    <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/RateMontonicScheduling-MissedDeadlinesCase.png" alt="RateMonotonicScheduling-MissedDeadline" /></li>
    <li>In this case It can’t satisfy the <code class="language-plaintext highlighter-rouge">Hard real-time systems</code></li>
  </ul>
</blockquote>

<h4 id="earliest-deadline-first-scheduling-edf">Earliest Deadline First Scheduling <code class="language-plaintext highlighter-rouge">EDF</code></h4>

<p><strong>Priorities are assigned according to deadlines</strong></p>

<p>\(The\ earlier\ the\ deadline,\ the\ higher\ the\ priority\)
\(The\ later\ the\ deadline,\ the\ lower\ the\ priority\)</p>

<blockquote>
  <p>[!example]+ EDF Example 
 $P_1$ needs to run for 25 ms every 50 ms. 
 	- $t = 25, d = p = 50$
$P_2$ needs to run for 35 ms every 80 ms. 
	- $t = 35, d = p = 80$
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/EDF.png" alt="EDF" /></p>
</blockquote>

<h4 id="proportional-share-scheduling">Proportional Share Scheduling</h4>

<p><strong>T shares are allocated among all processes in the system</strong></p>

<blockquote>
  <p>[!example]+ Example of Proportional Share Scheduling
 T = 20, therefore there are 20 shares, where one share represents 5% of the CPU time</p>
  <ul>
    <li>An application receives N shares where $N &lt; T$</li>
    <li>This ensures each application will receive $\frac{N}{T}$ of the total processor time</li>
    <li>Example: an application receives N = 5 shares the application then has 5 / 20 = 25% of the CPU time.</li>
    <li>This percentage of CPU time is available to the application whether the application uses it or not.</li>
    <li><strong>无论应用程序是否使用这些CPU时间，这些份额都被保留给它。</strong></li>
  </ul>
</blockquote>

<h2 id="operating-system-examples">Operating System Examples</h2>

<ul>
  <li>Linux Scheduling</li>
  <li>Windows Scheduling</li>
</ul>

<h3 id="linux-scheduling">Linux Scheduling</h3>

<blockquote>
  <p>[!info]+  Scheduling classes</p>
  <ul>
    <li>2 scheduling classes are included, others can be added
      <ol>
        <li>default</li>
        <li>real-time</li>
      </ol>
    </li>
    <li>Each process/task has specific priority</li>
  </ul>
</blockquote>

<ul>
  <li>Real-time scheduling according to POSIX.1b
    <ul>
      <li>Real-time tasks have static priorities</li>
    </ul>
  </li>
  <li>Real-time plus normal tasks map into global priority scheme
    <ul>
      <li>Nice value of -20 maps to global priority 100</li>
      <li>Nice value of +19 maps to priority 139</li>
      <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/LinuxScheduling-Priority.png" alt="LinuxScheduling-Priority" /></li>
    </ul>
  </li>
</ul>

<h4 id="completely-fair-scheduler-cfs">Completely Fair Scheduler <code class="language-plaintext highlighter-rouge">CFS</code></h4>

<p><strong>Scheduler picks highest priority task in highest scheduling class</strong></p>

<ul>
  <li>Quantum is not fixed <code class="language-plaintext highlighter-rouge">时间片不固定</code></li>
  <li>Calculated based on nice value from -20 to +19
    <ul>
      <li>Lower value is higher priority</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>[!abstract]+ CFS Mechanism</p>
  <ul>
    <li>CFS maintains per task virtual run time in variable <code class="language-plaintext highlighter-rouge">vruntime</code> ^[<strong>虚拟运行时间（vruntime）</strong>：CFS使用一个名为<code class="language-plaintext highlighter-rouge">vruntime</code>的变量来追踪每个进程应该获得的CPU时间。<code class="language-plaintext highlighter-rouge">vruntime</code>的增加速度取决于进程的优先级：优先级较低的进程（<code class="language-plaintext highlighter-rouge">nice</code>值较高）的<code class="language-plaintext highlighter-rouge">vruntime</code>增长得更快。]</li>
    <li>Associated with decay factor based on priority of task =&gt; lower priority is higher decay rate  ^[<strong>衰减因子</strong>：CFS使用衰减因子来根据进程的优先级调整其<code class="language-plaintext highlighter-rouge">vruntime</code>，优先级越低的进程，其<code class="language-plaintext highlighter-rouge">vruntime</code>的增长越快，从而减少它们被调度的概率。]</li>
    <li>Normal default priority (Nice value: 0) yields virtual run time = actual run time</li>
    <li>To decide next task to run, scheduler picks task with lowest virtual run time ^[<strong>选择下一个运行的进程</strong>：当需要选择下一个运行的进程时，CFS选择<code class="language-plaintext highlighter-rouge">vruntime</code>最低的进程，以尝试平等地分配CPU时间给每个进程。]
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/LinuxScheduling.png" alt="LinuxScheduling" /></li>
  </ul>
</blockquote>

<h3 id="windows-scheduling">Windows Scheduling</h3>

<p><strong>Windows uses priority-based preemptive scheduling</strong></p>

<ul>
  <li>*Highest-priority thread runs next *
    <ul>
      <li>Thread runs until
        <ul>
          <li>
            <ol>
              <li>blocks,</li>
            </ol>
          </li>
          <li>
            <ol>
              <li>uses time slice,</li>
            </ol>
          </li>
          <li>
            <ol>
              <li>preempted by higher-priority thread</li>
            </ol>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><em>Real-time threads can preempt non-real-time</em></li>
  <li><em>32-level priority scheme</em>
    <ul>
      <li>Variable class is 1-15, real-time class is 16-31</li>
      <li>Priority 0 is memory-management thread</li>
      <li>There is a queue for each priority</li>
      <li>If no run-able thread, runs idle thread</li>
    </ul>
  </li>
  <li>
    <p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/WindowsScheduling.png" alt="Windows Scheduling" /></p>
  </li>
  <li>
    <p>Windows操作系统中进程可以属于六种优先级类别，每个类别中各个相对优先级的数值。Windows API定义了实时类（real-time class）和变量类（variable class），每个类别中都有不同的优先级级别。</p>
  </li>
  <li>
    <p><strong>在实时类别中</strong>，有一个时间关键（time-critical）优先级，这是最高的优先级，数值为31。其他优先级依次降低，直到最低的空闲（idle）优先级，数值为16。这些优先级是为需要即时响应的任务设计的，比如那些在特定时间限制内必须完成的任务。</p>
  </li>
  <li>
    <p><strong>在变量类别中</strong>，优先级从高（high）到空闲（idle）不等。每个优先级类别还有相对优先级，如正常（normal）类别的优先级数值范围从15到6不等。这些优先级通常用于普通应用程序和后台任务。</p>
  </li>
  <li><strong>“变量”（Variable</strong> 意味着线程的优先级可以改变，即使它们属于同一类别。这允许操作系统根据当前的需求和资源情况动态调整进程的优先级。</li>
  <li>在调度时，系统会选择优先级数值最高的线程来执行，确保时间敏感的任务能够获得及时的处理。通过这种方式，操作系统可以管理多任务环境中的资源分配，确保关键任务能够及时完成，同时为不太重要的任务提供必要的CPU时间。</li>
</ul>

        </content>
        <side style="font-size: 0.9em">
            <h3 style="margin-bottom: 1em">BackLink</h3>
            
            <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
                
                <div class="backlink-box">
                    <a class="internal-link"
                        href="/OperatingSystem/CPU-Scheduling">Cpu Scheduling</a><br>
                    <!-- <div style="font-size: 0.9em">[[CPU-Scheduling]]
</div> -->
                </div>
                
                <div class="backlink-box">
                    <a class="internal-link"
                        href="/OperatingSystem/OperatingSystem">OperatingSystem</a><br>
                    <!-- <div style="font-size: 0.9em">[[OperatingSystem]]
</div> -->
                </div>
                
            </div>
            
        </side>
    </div>
</div>


</main>
</div>
<!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  var linkHistories = {};

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      if (!linkHistories[event.target.href]) {
        iframe.src = event.target.href
        iframe.onload = function() {
          tooltipContentHtml = ''
          tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
          tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

          tooltipContent.innerHTML = tooltipContentHtml
          linkHistories[event.target.href] = tooltipContentHtml

          tooltipWrapper.style.display = 'block';
          setTimeout(function() {
            tooltipWrapper.style.opacity = 1;
          }, 1)
        } 
      } else {
        tooltipContent.innerHTML = linkHistories[event.target.href]
        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }


      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

    document.querySelectorAll('.internal-link').forEach(setupListeners);
</script>

<script
  repo="yaleiyale/yaleiyale-comment" # 请建立你自己的评论仓库
  src="https://utteranc.es/client.js"
  issue-term="url"
  theme="github-light"
  crossorigin="anonymous"
  async="async"
></script>

  </div>
</div>



<link
  rel="stylesheet"
  href="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"
/>
<style>
  .katex-display>.katex {
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-all;
  }
</style>
<script
  src="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"
  defer="defer"
></script>
<script
 src="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
 defer="defer"
 onload='renderMathInElement(document.querySelector(".wrapper"), { delimiters: [{left: "$$", right: "$$", display: true}, { left: "$", right: "$", display: false }, {left: "\\(", right: "\\)", display: false}, {left: "\\[", right: "\\]", display: true}]})'
></script>




<style>
  pre.language-vega-lite,
  code.language-vega-lite {
    display: none;
  }
</style>
<script
  src="https://cdn.jsdelivr.net/combine/npm/vega@5.22.1,npm/vega-lite@5.2.0,npm/vega-embed@6.21.0"
  async="async"
  onload='
    for(let x of document.getElementsByClassName("language-vega-lite"))
      if(x.nodeName=="CODE")
      {
        let m = document.createElement("div");
        x.parentNode.insertAdjacentElement("beforebegin", m);
        vegaEmbed(m, JSON.parse(x.textContent));
      }'
></script>




<style>
  pre.language-mermaid,
  code.language-mermaid {
    display: none;
  }
  @media only screen {
    .mermaid {
      overflow: hidden hidden;
      max-width: 100%;
      max-height: 66.6vh;
    }
    .mermaid {
      overflow: auto auto;
    }
  }
</style>
<script
  src="https://cdn.jsdelivr.net/npm/mermaid@9.1.3/dist/mermaid.min.js"
  async="async"
  onload='
    for(let x of document.getElementsByClassName("language-mermaid"))
      if(x.nodeName=="CODE")
      {
        let m = document.createElement("div");
        m.classList.add("mermaid");
        m.textContent = x.textContent;
        x.parentNode.insertAdjacentElement("beforebegin", m);
      }'
></script>




<script type="text/javascript">
   var tags = {
    '[!note]': '<i class="fa-solid fa-pencil"></i>',
    '[!abstract]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!summary]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!tldr]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!info]': '<i class="fa-solid fa-circle-info"></i>',
    '[!todo]': '<i class="fa-solid fa-circle-info"></i>',
    '[!tip]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!hint]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!important]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!success]': '<i class="fa-solid fa-check"></i>',
    '[!check]': '<i class="fa-solid fa-check"></i>',
    '[!done]': '<i class="fa-solid fa-check"></i>',
    '[!question]': '<i class="fa-regular fa-circle-question"></i>',
    '[!help]': '<i class="fa-regular fa-circle-question"></i>',
    '[!faq]': '<i class="fa-regular fa-circle-question"></i>',
    '[!warning]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!caution]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!attention]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!failure]': '<i class="fa-solid fa-xmark"></i>',
    '[!fail]': '<i class="fa-solid fa-xmark"></i>',
    '[!missing]': '<i class="fa-solid fa-xmark"></i>',
    '[!danger]': '<i class="fa-solid fa-bolt"></i>',
    '[!error]': '<i class="fa-solid fa-bolt"></i>',
    '[!bug]': '<i class="fa-solid fa-bug"></i>',
    '[!example]': '<i class="fa-solid fa-list-ul"></i>',
    '[!quote]': '<i class="fa-solid fa-quote-right"></i>',
    '[!cite]': '<i class="fa-solid fa-quote-right"></i>'
  };
  var blocklist = document.querySelectorAll("blockquote");
  var blockCount = blocklist.length;
  var blockNow;
  for (var i = 0; i < blockCount; i++) {
    blockNow = blocklist[i];
    var find = false;
    for (var key in tags) {
      if (blockNow.innerHTML.indexOf(key) != -1) {
        blockNow.innerHTML = blockNow.innerHTML.replace(key, "");
        blockNow.childNodes[1].innerHTML = tags[key] + blockNow.childNodes[1].innerHTML;
        blocklist[i].innerHTML = blockNow.innerHTML;
        find = true;
        break;
      }
    }
    if(!find){
        blockNow.childNodes[1].innerHTML = '<i class="fa-solid fa-quote-left"></i><br>' + blockNow.childNodes[1].innerHTML;
        blocklist[i].innerHTML = blockNow.innerHTML;
      }
  }
</script>




<script>
  if (is_weixn_qq()) {
   window.location.href = "https://c.pc.qq.com/middle.html?pfurl="+window.location.href;
  }
  function is_weixn_qq(){
  var ua = navigator.userAgent;
  var isWeixin = !!/MicroMessenger/i.test(ua);
  var isQQ = !!/QQ\//i.test(ua);
  if(isWeixin||isQQ){
    return true;
   }
    return false;
  }
</script>




<style>
  pre .btn-pre-copy {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    position: absolute;
    top: 10px;
    right: 12px;
    font-size: 12px;
    line-height: 1;
    cursor: pointer;
    color: hsla(0, 0%, 54.9%, .8);
    transition: color .1s;
  }
</style>
<script>
  let preList = document.querySelectorAll("pre");
  for (let pre of preList) {
    let btn = document.createElement("div");
    pre.appendChild(btn);
    btn.className = "btn-pre-copy";
    btn.innerHTML = "复制";
   btn.onclick = function () {
     btn.innerHTML = "";
     toClip(pre.innerText);
      btn.innerHTML = "复制成功";
      setTimeout(() => {
       btn.innerHTML = "复制";
     }, 800);
    }
 }
  function toClip(text) {
    navigator.clipboard.writeText(text)
      .then(() => {
        console.log("Text copied to clipboard...");
      })
      .catch(err => {
        console.log('Something went wrong', err);
      });
  }
</script>




<script 
  src="https://cdn.jsdelivr.net/gh/yaleiyale/lamu-leimu-button@master/lamu-leimu.min.js"
></script>



    
  </div>
  
  <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  
  
</body>

</html>

