<!DOCTYPE html>
<html lang="zh">
<head>
  <title>
    
    Operating System Introduction &middot; AllenYGY的个人小站
    
  </title>
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Operating System Introduction" />
<meta name="author" content="AllenYGY" />
<meta property="og:locale" content="zh" />
<meta name="description" content="[[Operating-System-Introduction]]" />
<meta property="og:description" content="[[Operating-System-Introduction]]" />
<link rel="canonical" href="https://allenygy.github.io/OperatingSystem/Operating-System-Introduction" />
<meta property="og:url" content="https://allenygy.github.io/OperatingSystem/Operating-System-Introduction" />
<meta property="og:site_name" content="AllenYGY的个人小站" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-13T13:40:44+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Operating System Introduction" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"AllenYGY"},"dateModified":"2024-09-13T13:40:44+08:00","datePublished":"2024-09-13T13:40:44+08:00","description":"[[Operating-System-Introduction]]","headline":"Operating System Introduction","mainEntityOfPage":{"@type":"WebPage","@id":"https://allenygy.github.io/OperatingSystem/Operating-System-Introduction"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Myicon-0.png"},"name":"AllenYGY"},"url":"https://allenygy.github.io/OperatingSystem/Operating-System-Introduction"}</script>
<!-- End Jekyll SEO tag -->

  
  
  <script>
  (n=>{"use strict";let r,s,e;const l=["cdn.jsdelivr.net","fastly.jsdelivr.net","gcore.jsdelivr.net","cdn.zenless.top","testingcf.jsdelivr.net","test1.jsdelivr.net"],t="//",a=l[0],i=Date.now(),o=2e3,c="jsdelivr-auto-fallback",f="/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?",d=e=>e&&e.includes(t+a),m=e=>e.replace(t+a,t+r),u=window.setTimeout,v=n.querySelectorAll.bind(n),g=()=>{let e,t;for(e of v('link[rel="stylesheet"]'))t=e.href,d(t)&&!t.includes(f)&&(e.href=m(t));for(e of v("script"))if(t=e.src,d(t)){const r=n.createElement("script");r.src=m(t),e.defer=!0,e.src="",e.before(r),e.remove()}for(e of v("img"))t=e.src,d(t)&&(e.src="",e.src=m(t));for(e of v("*[style]"))t=e.getAttribute("style"),d(t)&&e.setAttribute("style",m(t));for(e of v("style"))t=e.innerHTML,d(t)&&(e.innerHTML=m(t))},y=()=>{!e&&s&&r&&(console.warn(a+" is not available. Use "+r),e=!0,u(g,0),u(g,20),setInterval(g,500))},b=(()=>{try{return Object.assign({},JSON.parse(localStorage.getItem(c)||"{}"))}catch{return{}}})();var h=()=>{b.time=i,b.failed=!1,b.fastNode=null;for(const t of l)((e,t)=>{let r;const s=n.createElement("link"),l=e=>{r&&(clearTimeout(r),r=0,e||(s.href="data:text/plain;base64,"),s.remove(),t(e))};r=u(l,o),s.addEventListener("error",()=>l(!1)),s.addEventListener("load",()=>l(!0)),s.rel="stylesheet",s.text="text/css",s.href=e+f+i,n.head.insertAdjacentElement("afterbegin",s)})("https://"+t,e=>{e||t!==a||(s=!0,b.failed=!0),e&&!r&&(r=t),e&&!b.fastNode&&(b.fastNode=t),y()});u(()=>{s&&!r&&(r=l[1],y()),localStorage.setItem(c,JSON.stringify(b))},o+100)};b.time&&i-b.time<36e5&&b.failed&&b.fastNode?(s=!0,r=b.fastNode,y(),u(h,1e3)):h()})(document);
</script>

  
  <style>
  .theme-base-07 {
    --theme-base-color: darkslateblue;
  }
</style>

  
  <meta
  name="viewport"
  content="width=device-width,minimum-scale=1,initial-scale=1"
/>
<meta
  http-equiv="content-type"
  content="text/html; charset=utf-8"
/>
<meta 
  name="referrer"
  content="no-referrer" 
/>
<link
  rel="alternate"
  href="/feed.xml"
  title="RSS"
  type="application/rss+xml"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/combine/gh/poole/lanyon@v1.1.0/public/css/poole.min.css,gh/poole/lanyon@v1.1.0/public/css/lanyon.min.css,gh/poole/lanyon@v1.1.0/public/css/syntax.min.css"
/>
<link 
  rel="stylesheet" 
  href="/styles.css"
/>

  
  <link
  rel="apple-touch-icon-precomposed"
  href="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Logo-4.png"
/>
<link
  rel="shortcut
  icon"
  href="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Logo-4.png"
/>

  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"
/>

  
  <style>
  .sidebar, html, h1, h2, h3, h4, h5, h6, code, pre {
    font-family:'MiSans';
  }
</style>

  
</head>

<body
  class="theme-base-0d layout-reverse sidebar-overlay">
  
  
  
  
  <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"  />
  
  <div class="sidebar" id="sidebar">
    
    <div class="sidebar-item">
      <div class="effect effect-right_to_left">
        <img class="effect-img" src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/icon/Myicon-0.png" alt="img" />
        <div class="effect-info">
          <br>
<br>
轻阴阁小雨，
<a href="mailto:allenygy@outlook.com">
  <i class="fa-solid fa-envelope fa-fw"></i>
</a>
<br/>
深院昼慵开。
<a href="https://github.com/ALLENYGY">
  <i class="fa-brands fa-github fa-fw"></i>
</a>
<br/>
坐看苍苔色，
<a href="https://allenygy.github.io">
  <i class="fa-solid fa-otter fa-fw"></i>
</a>
<br/>
欲上人衣来。
<a href="https://allenygy.github.io">
  <i class="fa-brands fa-bilibili" fa-fw></i>
</a>

        </div>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      
      <a class="sidebar-nav-item" href="/">
        <i class="fa-solid fa-home fa-fw"></i> 首页
      </a>
      
      <a class="sidebar-nav-item" href="/contents">
        <i class="fa-solid fa-book fa-fw"></i> 目录
      </a>
      
      <a class="sidebar-nav-item" href="/OS">
        <i class="fa-solid fa-laptop fa-fw"></i> 操作系统
      </a>
      
      <a class="sidebar-nav-item" href="/DCN">
        <i class="fa-solid fa-network-wired"></i> 计算机网络
      </a>
      
      <a class="sidebar-nav-item" href="/CO">
        <i class="fa-solid fa-atom fa-fw"></i> 计算机组成原理
      </a>
      
      <a class="sidebar-nav-item" href="/Program">
        <i class="fa-solid fa-code fa-fw"></i> 编程语言
      </a>
      
      <a class="sidebar-nav-item" href="/Math">
        <i class="fa-solid fa-tools fa-fw"></i> 数学
      </a>
      
      <a class="sidebar-nav-item" href="/DBM">
        <i class="fa-solid fa-database fa-fw"></i> 数据库
      </a>
      
      <a class="sidebar-nav-item" href="/Tools">
        <i class="fa-solid fa-tools fa-fw"></i> 编程素养
      </a>
      
      <a class="sidebar-nav-item" href="/archive">
        <i class="fa-solid fa-archive fa-fw"></i> 归档
      </a>
      
      <a class="sidebar-nav-item" href="/tags">
        <i class="fa-solid fa-tags fa-fw"></i> 标签
      </a>
      
      <a class="sidebar-nav-item" href="/map">
        <i class="fa-solid fa-circle-nodes fa-fw"></i> 图谱
      </a>
      
      <a class="sidebar-nav-item" href="/links">
        <i class="fa-solid fa-user-friends fa-fw"></i> 友链
      </a>
      
    </nav>
    <div class="sidebar-item">
      
      <input
  id="sidebar-search-input"
  placeholder="搜索博文"
/>
<ol
  id="sidebar-search-results-container"
></ol>
<script
  src='https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.9.1'
  async='async'
  onload='
    SimpleJekyllSearch({
      json: "/assets/simple-jekyll-search/search.json",
      searchInput: document.getElementById("sidebar-search-input"),
      resultsContainer: document.getElementById("sidebar-search-results-container"),
      searchResultTemplate: `<li><a href="{url}">{title}</a></li>`,
      limit: 99,
      fuzzy: true
    })'
></script>

      
      
      <ol id="toc">
  <li><a href="#operating-system-introduction">Operating-System-Introduction</a>
    <ol>
      <li><a href="#computer-system-architecture">Computer System Architecture</a>
        <ol>
          <li><a href="#io-device-in-computer">I/O Device In Computer</a></li>
          <li><a href="#cpu-and-memory-in-computer">CPU and Memory in Computer</a></li>
        </ol>
      </li>
      <li><a href="#operating-systems">Operating Systems</a>
        <ol>
          <li><a href="#interrupts-%E4%B8%AD%E6%96%AD">Interrupts 中断</a>
            <ol>
              <li><a href="#interrupt-handling-steps">Interrupt Handling Steps</a></li>
              <li><a href="#dma">DMA</a></li>
              <li><a href="#interrupt-driven-io-cycle-timeline-view">Interrupt-Driven I/O Cycle: Timeline View</a></li>
              <li><a href="#interrupt-driven-io-cycle-two-methods">Interrupt-Driven I/O Cycle: Two Methods</a></li>
            </ol>
          </li>
        </ol>
      </li>
      <li><a href="#operating-system-activities">Operating System Activities</a>
        <ol>
          <li><a href="#caching">Caching</a></li>
          <li><a href="#process-management">Process Management</a></li>
          <li><a href="#memory-management">Memory Management</a></li>
          <li><a href="#file-system-management">File System Management</a></li>
          <li><a href="#secondary-storage-management">Secondary Storage Management</a></li>
          <li><a href="#io-subsystem">I/O Subsystem</a></li>
          <li><a href="#protection-and-security">Protection and Security</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
      
      
      <script defer="defer" >
 !function (e) {
   var flag = /Android|iPhone|iPad|iPod|BlackBerry|webOS|Windows Phone|SymbianOS|IEMobile|Opera Mini/i.test(navigator.userAgent);
   if (flag) {
      var c = e.querySelector(".sidebar-toggle"),
      r = e.querySelector("#sidebar"),
      t = e.querySelector("#sidebar-checkbox");
      e.addEventListener("click", function (e) {
      var n = e.target;
      t.checked && !r.contains(n) && n !== t && n !== c && (t.checked = !1)
    }, !1)
  } 
}(document);
</script>

      
      <style>
  #sidebar-checkbox:checked ~ .sidebar-toggle,
  .sidebar,
  .sidebar-toggle:active {
    background-color: var(--theme-base-color);
  }
</style>

      
      <div>
  <i class="fa-solid fa-cog fa-spin fa-fw"></i>
  <span id="run_time_day">
  </span>天
  <span id="run_time_hour">
  </span>时
  <span id="run_time_minute">
  </span>分
  <span id="run_time_second">
  </span>秒
  <script>
    setInterval(function (d,h,m,s,b) {
      function setzero(i) {
        return i < 10 ? "0" + i : i;
      }
      let BirthDay = new Date(b);
      let today = new Date();
      let timeold = (today.getTime() - BirthDay.getTime());
      let sectimeold = timeold / 1000;
      let secondsold = Math.floor(sectimeold);
      let msPerDay = 24 * 60 * 60 * 1000;
      let e_daysold = timeold / msPerDay;
      let daysold = Math.floor(e_daysold);
      let e_hrsold = (e_daysold - daysold) * 24;
      let hrsold = Math.floor(e_hrsold);
      let e_minsold = (e_hrsold - hrsold) * 60;
      let minsold = Math.floor((e_hrsold - hrsold) * 60);
      let seconds = Math.floor((e_minsold - minsold) * 60);
      d.textContent = daysold;
      h.textContent = setzero(hrsold);
      m.textContent = setzero(minsold);
      s.textContent = setzero(seconds);
    },
    1000,
    document.getElementById("run_time_day"),
    document.getElementById("run_time_hour"),
    document.getElementById("run_time_minute"),
    document.getElementById("run_time_second"),
    "03/20/2024 16:27:40")
  </script>
</div>

      
      <div>
  <div>
    <i class="fa-solid fa-eye fa-fw"></i>
    <span id="busuanzi_value_page_pv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>次
  </div>
  <div>
    <i class="fa-solid fa-paw fa-fw"></i>
    <span id="busuanzi_value_site_pv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>枚
  </div>
  <div>
    <i class="fa-solid fa-user-friends fa-fw"></i>
    <span id="busuanzi_value_site_uv">
      <i class="fa-solid fa-spinner fa-pulse"></i>
    </span>人
  </div>
  <script
    src='https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js'
    async='async'
  ></script>
</div>

      
      <div>
  <i class="fa-solid fa-thumbs-up fa-fw"></i>
  <a href="https://github.com/ALLENYGY/jekyll-theme-ObJekyll">
    theme-ObJekyll
  </a>
</div>

      
      <div>
  <i class="fa-solid fa-copyright fa-fw"></i>
  2024 ALLENYGY
</div>

      
      
      <div>
        <i class="fa-solid fa-user-edit fa-fw"></i>
        
        
        
        47万
        
          
        
        2千
        94字
        
      </div>
      
    </div>
  </div>
  
  
  <div class="wrap">
    
    
    
    
<style>
  h1::before,
  h2::before,
  h3::before,
  h4::before,
  h5::before,
  h6::before {
    font-family: "Font Awesome 6 Free";
    font-weight: bold;
    font-size: smaller;
    margin-right: .5rem;
    content: "\f292";
  }
</style>



<div class="container content">
  <div class="page">
    
    <h1 class="page-title">Operating System Introduction</h1>
    
    <div class="wrapper">
    <main><div class="post">
    <span class="post-date">
        
        <i class="fa-solid fa-calendar-day fa-fw"></i>
        改于：2024-05-31 01:27:00 Friday
        <br>
        
        
        <i class="fa-solid fa-calendar-plus fa-fw"></i>
        建于：2024-01-20 17:14:00 Saturday
        
        
        <i class="fa-solid fa-file-word fa-fw"></i>
        10197字
        
        
        <i class="fa-solid fa-clock fa-fw"></i>
        34分
        
        
        
        <br>
        
        OS, NOTE, Introduction, and Lec1
        
        
        <br/>
<i class="fab fa-creative-commons-by fa-fw"></i>
<a
  href="https://creativecommons.org/licenses/by/4.0/deed.zh"
  rel="license">
  CC BY 4.0（除特别声明或转载）
</a>

        
    </span>
    <div id="notes-entry-container">
        <content>
            <h1 id="operating-system-introduction"><a class="internal-link" href="/OperatingSystem/Operating-System-Introduction">Operating-System-Introduction</a></h1>

<h2 id="computer-system-architecture"><strong>Computer System Architecture</strong></h2>

<p><strong>主要由<code class="language-plaintext highlighter-rouge">Memory</code>,<code class="language-plaintext highlighter-rouge">CPU</code>,<code class="language-plaintext highlighter-rouge">I/O Devices</code>构成</strong></p>

<ul>
  <li>Memory</li>
  <li>CPU</li>
  <li>I/O Devices
    <ul>
      <li>disks</li>
      <li>mouse</li>
      <li>keyboard</li>
      <li>printer</li>
      <li>monitor</li>
      <li>…</li>
    </ul>
  </li>
</ul>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/ComputerSystemArchitecture.png" alt="ComputerSystemArchitecture" /></p>

<hr />

<h3 id="io-device-in-computer"><strong>I/O Device In Computer</strong></h3>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/ComputerSystemArchitecture.png" alt="ComputerSystemArchitecture" /></p>

<blockquote>
  <p>[!tip]- I/O devices and the CPU can work concurrently
<strong>I/O设备与CPU并发工作</strong></p>
  <ul>
    <li>这意味着CPU可以处理指令，同时I/O设备可以进行数据传输，它们不必等待彼此完成任务才开始工作。</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Controller</p>
  <ul>
    <li>每个I/O设备都通过一个控制器与系统总线连接。控制器负责管理与特定I/O设备的数据传输。</li>
    <li>例如，磁盘驱动器通过磁盘控制器连接，鼠标和键盘可能通过USB控制器连接。</li>
    <li>设备控制器负责管理特定设备的操作，并且每个控制器都有其自己的本地缓冲区。</li>
    <li>控制器确保数据正确无误地在设备和计算机的内存之间传输。</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Each device controller is in charge of a particular device type</p>
  <ul>
    <li>每个设备控制器被一个特定的设备控制</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Each device controller has a local buffer</p>
  <ul>
    <li>每个设备控制器都有一个本地缓存</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Local Buffer  <strong>本地缓冲区</strong></p>
  <ul>
    <li>每个设备控制器都有一个本地缓冲区（或本地内存），用于临时存储从设备传输的数据或要传输到设备的数据。</li>
    <li>缓冲区可以平衡CPU和设备之间的速度差异，因为CPU通常比I/O设备快得多。</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- System Bus
<strong>系统总线</strong></p>
  <ul>
    <li>系统总线是连接CPU、内存和所有I/O设备控制器的通道。</li>
    <li>它允许数据在CPU、内存和I/O设备之间传输。</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- I/O is between the device and local buffer of controller</p>
  <ul>
    <li>IO 发生在设备与控制器的缓冲区之间</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Memory
<strong>内存</strong></p>
  <ul>
    <li>在图中，内存单独显示，表示它与CPU和所有I/O设备通过系统总线相连。</li>
    <li>内存用于存储CPU当前正在处理的数据和指令，以及等待被I/O设备处理的数据。</li>
  </ul>
</blockquote>

<hr />

<h3 id="cpu-and-memory-in-computer"><strong>CPU and Memory in Computer</strong></h3>

<p><strong>CPU与Memory间的关系</strong> 可以分成三种模型</p>

<blockquote>
  <p>[!tip]- Single Processor &amp; Multiple Processor  <strong>单处理器</strong> 和 <strong>多处理器</strong></p>
  <ul>
    <li><strong>单处理器</strong></li>
    <li>这是最基本的配置，有一个CPU负责处理所有计算任务。
      <ul>
        <li>这个CPU有自己的<em>寄存器</em>和<em>缓存</em>来处理指令和数据。</li>
      </ul>
    </li>
    <li><strong>多处理器</strong></li>
    <li>在这种配置中，有两个或更多的独立CPU或处理器
      <ul>
        <li>与单处理器相同每个CPU都有自己的<em>寄存器</em>和<em>缓存</em>。</li>
        <li>这些处理器<strong>共享主内存</strong>，允许它们处理更多的任务和并行计算。</li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Dual Core <strong>双核处理器</strong></p>
  <ul>
    <li>双核处理器实际上是一个包含两个<em>独立核心</em>的单个CPU。
      <ul>
        <li>每个核心都有自己的<em>Regisiter</em>和 <em>L1 cache</em>。</li>
        <li>它们共享一个二级缓存<em>L2 cache</em>和 <em>Main Memory</em>。</li>
        <li>这允许一个处理器在同一时间内处理更多的任务。</li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- NUMA  <strong>非统一内存访问系统</strong></p>
  <ul>
    <li>NUMA是一种内存设计，其中多个处理器被分配专用的<strong>内存块</strong>。</li>
    <li>每个CPU可以访问自己的内存<code class="language-plaintext highlighter-rouge">memory0, memory1,....</code>，以及其他CPU的内存，但访问其他CPU的内存会有更高的延迟。</li>
    <li>这种设计可以提高处理器访问内存的速度和效率，特别是在处理大量数据或高性能计算任务时。</li>
  </ul>
</blockquote>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/CPU.png" alt="CPU" /></p>

<hr />
<h2 id="operating-systems"><strong>Operating Systems</strong></h2>

<blockquote>
  <p>[!abstract]+</p>
  <ul>
    <li>操作系统作为用户和计算机硬件的中介</li>
    <li>它主要包括kernel,以及系统程序，应用程序，中间件(软件框架，如数据库，多媒体，…)</li>
    <li>操作系统是中断驱动的
      <ul>
        <li>内核中的设备驱动器管理支配设备</li>
        <li>设备控制器通过中断告知CPU，设备已经完成操作</li>
        <li>内核的代码只有当中断发生时才执行</li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!tip]- Operating System: Intermediary between a User and the Computer Hardware —-用户与操作系统的中介</p>
  <ul>
    <li>An operating system provides interface to a user, runs a program for a user</li>
    <li>Application Program: Compilers, web browsers….</li>
    <li>Computer Hardware: CPU, Memory, I/O devices…
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Intermediary.png" alt="Intermediary" /></li>
  </ul>
</blockquote>

<blockquote>
  <p>[!info]+ General goals of operation systems</p>
  <ul>
    <li>Execute user programs and make solving user problems easier <em>更简单的执行 User Programs</em></li>
    <li>Make the computer system convenient to use <em>更方便的使用Computer System</em></li>
    <li>Use the computer hardware in an efficient manner <em>更高效的使用Computer Hardware</em></li>
  </ul>
</blockquote>

<p>%% &gt; [!quote] A definition: “Everything a vendor ships when you order an operating system” %%</p>

<blockquote>
  <p>[!Question]+ What is Operating System ?
OS Include:</p>
  <ul>
    <li><strong>Kernel</strong> Part of a operating system, resides in memory at all times on the computer
 <img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/KernelInMemory.png" alt="KernelInMemory" /></li>
    <li><strong>Others</strong>
      <ul>
        <li><strong>System programs</strong> -all programs associated with the operating system, but not in kernel</li>
        <li><strong>Application programs</strong> - all programs not associated with the operating system</li>
        <li><strong>Middleware</strong><code class="language-plaintext highlighter-rouge">中间件</code>– a set of software frameworks that provide additional services to application developers such as:  databases, multimedia, graphics</li>
      </ul>
    </li>
  </ul>
</blockquote>

<blockquote>
  <p>[!abstract]+ Operating System Is <strong>Interrupt-Driven</strong></p>
  <ul>
    <li>Device driver inside the kernel knows how to talk and manage the device 
<em>在kernel中的设备驱动知道如何管理设备以及和设备交流</em></li>
    <li>Device driver provides <strong>uniform interface</strong> between <strong>controller</strong> and <strong>kernel</strong> 
<em>设备驱动器为控制器和内核提供统一接口</em></li>
    <li>Each device controller <strong>informs CPU</strong> that it has <strong>finished</strong> its <strong>operation by causing an interrupt</strong> 
<em>每个设备控制器通过中断告知CPU，它已经完成了它的操作</em>
The code of the kernel is in memory all the time but the code of the kernel is only executed when there is an interrupt, on demand!
<strong>内核的代码一直在内存中，但内核的代码只有在出现中断时才会按需执行！</strong>
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/DeviceDriverInKernel.png" alt="Device Driver In Kernel" /></li>
  </ul>
</blockquote>

<h3 id="interrupts-中断">Interrupts 中断</h3>

<blockquote>
  <p>[!abstract]+</p>
  <ul>
    <li>当软硬件发生需要OS立刻处理的事件时中断发生
      <ul>
        <li>在软件层面：由<code class="language-plaintext highlighter-rouge">Error</code>或者<code class="language-plaintext highlighter-rouge">System call</code>引起中断</li>
        <li>在硬件层面：由<code class="language-plaintext highlighter-rouge">Device</code> 引发</li>
      </ul>
    </li>
    <li>由ISR决定对于不同中断应该采取什么行动</li>
  </ul>

</blockquote>

<blockquote>
  <p>[!info]+ Interrupt
An <strong>interrupt</strong> is a signal emitted by <strong>hardware</strong> or <strong>software</strong> when a process or an event needs immediate attention</p>
  <ul>
    <li>Software: A trap or exception is a software-generated interrupt caused either by an error or a user request <em>(system call)</em></li>
    <li>Hardware: Device
[!abstract] Interrupt Service Routines (ISR)
ISR inside the kernel determine what action should be taken for each type of interrupt</li>
  </ul>
</blockquote>

<h4 id="interrupt-handling-steps"><strong>Interrupt Handling Steps</strong></h4>

<blockquote>
  <p>[!success]+ When there is an interrupt, the operating system
<strong>Preserves the state of the CPU</strong></p>
  <ul>
    <li>by storing registers and the program counter(PC) for the software that was just interrupted (so that the same software can be restarted later).</li>
  </ul>

  <p><strong>Determine type of interrupt</strong></p>
  <ul>
    <li>check Interrupt vector to get the address of corresponding ISR for this interrupt (used on all modern computers)</li>
  </ul>

  <p><strong>Runs ISR in kernel</strong> to handle interrupt</p>
</blockquote>

<hr />

<h4 id="dma"><strong>DMA</strong></h4>

<blockquote>
  <p>[!abstract]+ Direct Memory Access (DMA)
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/DMA.png" alt="DMA" /></p>

  <ol>
    <li>Device controller transfers blocks of data from buffer <strong>directly to main memory without CPU intervention</strong>, In the meantime the CPU can work on something else.</li>
  </ol>

  <ul>
    <li>DMA允许设备控制器直接将数据块从缓冲区传输到主内存，而不需要CPU干预。</li>
    <li>这样做的好处是CPU可以同时进行其他计算任务，而不需要管理这些数据传输。</li>
  </ul>

  <ol>
    <li><strong>Only one interrupt</strong> is generated per block</li>
    <li><strong>High transfer speed</strong>: not byte by byte, but block by block</li>
  </ol>
</blockquote>

<hr />

<h4 id="interrupt-driven-io-cycle-timeline-view"><strong>Interrupt-Driven I/O Cycle: Timeline View</strong></h4>

<blockquote>
  <p>[!success]+ Timeline View
<strong>CPU</strong></p>

  <ul>
    <li>CPU有两种状态，一种是执行用户程序，另一种是处理I/O中断。</li>
  </ul>

  <p><strong>I/O Device</strong></p>

  <ul>
    <li>I/O设备的状态可以是空闲的或正在传输数据。</li>
  </ul>

  <p><strong>I/O Request</strong></p>

  <ul>
    <li>当I/O设备准备好数据交换时，它会发出I/O请求。这通常发生在读取或写入操作开始时。</li>
  </ul>

  <p><strong>Interrupt</strong></p>

  <ul>
    <li>当I/O设备完成数据传输时，它会发出中断信号给CPU。在图表中，这些中断用垂直的绿线表示。</li>
  </ul>

  <p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Interrupt-Driven-Timeline.png" alt="Timeline" /></p>

  <p><strong>Interrupt Dealing</strong></p>

  <ul>
    <li>CPU在执行用户程序的过程中会接收到中断信号，然后切换到处理I/O中断的状态。这个过程中，CPU会停止当前的用户程序执行，保存必要的状态，并开始执行与中断处理相关的指令。</li>
  </ul>

  <p><strong>Transfer Done</strong></p>

  <ul>
    <li>一旦中断处理完成，I/O设备会标记为传输完成，并准备接收下一个I/O请求。</li>
  </ul>

  <p><strong>User Program Done</strong></p>

  <ul>
    <li>在I/O设备忙于传输数据（绿线下降部分）和CPU处理中断之间的时间，CPU会继续执行用户程序。</li>
  </ul>

  <p><strong>Red Circle</strong></p>

  <ul>
    <li>图表中的红色圆圈可能代表一个特定事件或异常，例如一个处理延迟或一个需要特殊注意的中断。
[!abstract]+
总的来说，这个时间线展示了中断驱动I/O如何使CPU在等待I/O操作完成时可以继续其他任务，从而提高了系统的效率。
当设备完成数据传输时，它通过中断通知CPU，CPU随后会处理该中断，并在处理完毕后恢复用户程序的执行。这种机制减少了CPU等待I/O操作的空闲时间。
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Interrupt-Driven-WorkflowView.png" alt="WorkflowView" /></li>
  </ul>
</blockquote>

<hr />

<h4 id="interrupt-driven-io-cycle-two-methods"><strong>Interrupt-Driven I/O Cycle: Two Methods</strong></h4>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/TwoIOMethods.png" alt="TwoIOMethods" />
这张图展示了中断驱动I/O周期的两种方法。
在两种情况下，I/O操作都是由中断控制的，但是用户程序对I/O完成的处理方式不同。</p>

<ol>
  <li><strong>Synchronous Method</strong>
    <ul>
      <li>在这种方法中，用户程序启动I/O操作后，会一直等待直到I/O操作完成后才继续执行。这是一个同步I/O操作，因为用户程序在请求的I/O操作完成之前不会进行任何其他工作。</li>
      <li>用户程序进入等待状态，操作系统的设备驱动程序启动硬件操作，数据传输开始。</li>
      <li>一旦数据传输完成，中断处理程序（interrupt handler）会处理相应的中断，并控制权返回到用户程序，用户程序继续执行。</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p>[!example]-
想象你去银行取号等待办理业务。这个过程可以类比为一个计算机中的同步I/O操作。</p>
  <ol>
    <li><strong>取号（启动I/O操作）</strong>:
      <ul>
        <li>你走进银行，取一个号码，并等待你的号码被叫到。取号就像是一个程序请求I/O操作，比如从磁盘读取数据。</li>
      </ul>
    </li>
    <li><strong>等待（等待I/O完成）</strong>:
      <ul>
        <li>取完号码后，你坐在等候区，不能离开，也不能做其他事情。你必须等待，直到银行工作人员叫到你的号码。在这个例子中，等待就像是程序在等待I/O操作完成。程序在这个等待期间不能执行其他任务，它被阻塞了。</li>
      </ul>
    </li>
    <li><strong>办理业务（处理I/O结果）</strong>:
      <ul>
        <li>当你的号码被叫到，你前往柜台，开始与银行职员交谈，完成你的业务。这一部分对应于中断处理程序在I/O操作完成后运行，处理数据。</li>
      </ul>
    </li>
    <li><strong>返回（控制权返回用户程序）</strong>:
      <ul>
        <li>业务办理完成后，你离开银行，可能回家或者去做其他事情。这就像是控制权从I/O操作返回到用户程序，用户程序继续执行其它任务。
在这个同步I/O操作的例子中，你（用户程序）在整个等待过程中无法进行其他活动。你必须等待直到被叫号（I/O操作完成），这样可能导致效率低下，因为你的时间被完全占据在等待过程中，无法同时进行多个任务。这就是同步I/O可能引发的性能问题，尤其是在处理长时间的I/O操作时。</li>
      </ul>
    </li>
  </ol>
</blockquote>

<ol>
  <li><strong>Asynchronous Method</strong>
    <ul>
      <li>在这种方法中，用户程序在启动I/O操作后不会等待I/O完成，而是立即继续执行其他工作。这是一个异步I/O操作，用户程序可以在I/O操作正在进行时做其他事情。</li>
      <li>用户程序发起I/O请求后，控制权立即返回，无需等待硬件操作完成。</li>
      <li>数据传输和中断处理会在后台进行，而用户程序在这个过程中可以继续执行其他任务。</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p>[!example]-
想象一下你在做饭，同时你想听音乐。你有一张CD和一个CD播放器（这里的CD播放器就像一个需要读取数据的I/O设备）。</p>
  <ol>
    <li><strong>启动播放器（请求I/O操作）</strong>:
      <ul>
        <li>你把CD放入播放器并按下播放按钮。这一动作启动了播放器的内部机械装置去读取CD上的数据。</li>
      </ul>
    </li>
    <li><strong>继续做饭（用户程序继续执行）</strong>:
      <ul>
        <li>一旦音乐开始播放，你不需要站在播放器旁边等待每首歌曲加载。相反，你可以继续做饭。这个阶段就像是服务器处理其他客户端请求或者进行其他工作。</li>
      </ul>
    </li>
    <li><strong>歌曲播放完毕（I/O操作完成）</strong>:
      <ul>
        <li>当一首歌曲播放完毕，CD播放器会自动读取下一首歌曲。如果我们把这比喻成一个中断，那么每当一首歌播放完毕，播放器就“中断”当前状态，转而开始播放下一首歌。</li>
      </ul>
    </li>
    <li><strong>不需要干预</strong>:
      <ul>
        <li>在整个过程中，你无需干预播放器的操作。你可以专注于做饭，而播放器在后台自行处理CD的播放。
这就是一个日常生活中的异步I/O示例：你启动了一个需要时间完成的任务（CD播放），但在它完成之前，你可以去做别的事情（做饭），而不是等待它完成。当播放器需要你注意（比如CD播放完毕）时，它会以音乐停止的方式提醒你，这就好比是一个中断信号。</li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>这两种方法的选择取决于程序设计的需求。</p>

<ul>
  <li><strong>同步I/O操作简单但可能效率较低</strong>，因为它会阻塞程序执行；</li>
  <li><strong>异步I/O操作更复杂</strong>，但允许多任务同时进行，提高了效率。在多线程环境中，异步I/O特别有用，因为它允许程序在等待I/O完成的同时，继续在其他线程上工作。</li>
</ul>

<hr />

<h2 id="operating-system-activities"><strong>Operating System Activities</strong></h2>

<ul>
  <li>Operating system does a lot of management work
    <ul>
      <li>Caching</li>
      <li>Process management</li>
      <li>Memory management</li>
      <li>File management</li>
      <li>Secondary storage management</li>
      <li>I/O</li>
      <li>Protection and security</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="caching"><strong>Caching</strong></h3>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Cache.png" alt="Cache" /></p>

<ul>
  <li>
    <p>Caching: Copy information from slower into faster storage system
<img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/TransferDirection.png" alt="TransferDirection" /></p>
  </li>
  <li>Data access procedure: faster storage (cache) checked first
    <ul>
      <li>Data exist, information is used directly from the cache (fast)</li>
      <li>Data not exist , data are copied from slower device to the faster.</li>
    </ul>
  </li>
  <li>Cache design consideration
    <ul>
      <li>size</li>
      <li>content replacement policy</li>
    </ul>
  </li>
  <li>Cache coherency
    <ul>
      <li>The coordination of the contents of caches such that an update to a value stored in one cache is immediately reflected in all other caches that hold that value</li>
    </ul>
  </li>
</ul>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/CharacteristicsofVariousTypesofStorage.png" alt="CharacteristicsofVariousTypesofStorage" /></p>

<hr />

<h3 id="process-management"><strong>Process Management</strong></h3>

<blockquote>
  <p>[!abstract]+ <strong>Program vs Process</strong>
A process is a program in execution</p>

  <ul>
    <li>Program is a passive entity, on storage</li>
    <li>Process is an active entity, in memory</li>
  </ul>
</blockquote>

<blockquote>
  <p>[!abstract]+ <strong>Process</strong></p>

  <ul>
    <li>Creation, execution needs resources
      <ul>
        <li>CPU, memory, I/O, files</li>
        <li>Initialization data</li>
      </ul>
    </li>
    <li>Termination requires reclaim of any reusable resources</li>
  </ul>
</blockquote>

<ul>
  <li>Process can be single-threaded, or multi-threaded</li>
  <li>Each process has a program counter to specify location of next instruction to execute</li>
</ul>

<hr />

<p><strong>Multiprogramming VS Multitasking</strong></p>

<ul>
  <li><strong>Multiprogramming</strong> : A subset of total jobs are kept in memory at the same time
    <ul>
      <li>Job scheduling: choose which jobs to load into memory.
        <ul>
          <li>When job has to wait (for I/O for example), OS switches to another job</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Multitasking</strong>: The CPU switches jobs so frequently to increase interactions with users
    <ul>
      <li>CPU scheduling: choose which job will run next If several jobs are ready to run at the same time</li>
    </ul>
  </li>
  <li><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Multiprogramming.png" alt="Scheduling" /></li>
</ul>

<hr />

<p><strong>Dual Mode</strong></p>

<p><img src="https://cdn.jsdelivr.net/gh/ALLENYGY/ImageSpace@master/IMAGE/OS/Dual-Mode.png" alt="Dual Mode" /></p>

<ul>
  <li>User Mode</li>
  <li>Kernel Mode</li>
</ul>

<p>Dual-mode operation allows OS to protect itself and other system components</p>

<blockquote>
  <p>[!abstract]- Dual Mode</p>

  <ol>
    <li><strong>用户模式（User mode）</strong>:
      <ul>
        <li>当进程运行在用户模式下时，它被限制只能执行<em>非特权指令</em>。用户模式下的进程不能直接执行可能会影响系统整体操作的操作，比如访问硬件设备或者修改关键系统数据。</li>
      </ul>
    </li>
    <li><strong>内核模式（Kernel mode）</strong>:
      <ul>
        <li>当进程运行在内核模式下时，它可以执行任何CPU指令。这通常包括访问硬件设备和内存管理操作。只有操作系统核心部分的代码才能在内核模式下运行。</li>
      </ul>
    </li>
    <li><strong>系统调用（System call）</strong>:
      <ul>
        <li>当用户进程需要操作系统服务时（比如读取文件、创建进程等），它会执行一个系统调用。这通常通过执行一个特殊的指令（如<code class="language-plaintext highlighter-rouge">trap</code>）来实现，这会导致CPU从用户模式切换到内核模式。</li>
      </ul>
    </li>
    <li><strong>模式位（Mode bit）</strong>:
      <ul>
        <li>CPU使用一个模式位来指示当前是在用户模式还是内核模式下执行。用户模式的模式位为1，内核模式的模式位为0。</li>
      </ul>
    </li>
    <li><strong>执行系统调用</strong>:
      <ul>
        <li>一旦进入内核模式，操作系统的内核会接管控制权，执行系统调用所请求的服务。</li>
      </ul>
    </li>
    <li><strong>返回用户模式</strong>:
      <ul>
        <li>系统服务完成后，操作系统会将控制权返回给用户进程，并且将模式位设置回1，进程继续在用户模式下运行。</li>
      </ul>
    </li>
  </ol>

  <p>双模式操作的关键好处是提供了一个安全层，确保用户进程不能直接执行可能会破坏系统稳定性或安全性的操作。这种机制允许操作系统保护自己和其他系统组件不受恶意或错误编程的用户进程的影响。</p>
</blockquote>

<hr />

<blockquote>
  <p>[!tip]+ Process management activities include:</p>

  <ul>
    <li>Creating and deleting both user and system processes</li>
    <li>Suspending and resuming processes</li>
    <li>Process synchronization</li>
    <li>Process communication</li>
    <li>Deadlock handling</li>
  </ul>
</blockquote>

<hr />

<h3 id="memory-management"><strong>Memory Management</strong></h3>

<ul>
  <li>To execute a program
    <ul>
      <li>All (or part) of the <strong>instructions</strong> of the <strong>program</strong> must be <em>in memory</em></li>
      <li>All (or part) of the <strong>data</strong> needed by the <strong>program</strong> must be <em>in memory</em></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>[!tip]+ Memory management activities include</p>

  <ol>
    <li>
      <p><em>Keeping track</em> of which parts of memory are currently being used and by whom</p>
    </li>
    <li>
      <p>Deciding which processes and data (or part of them) to move into and out of memory</p>
    </li>
    <li>
      <p>Allocating and de-allocating memory space as needed</p>
    </li>
  </ol>
</blockquote>

<hr />

<h3 id="file-system-management"><strong>File System Management</strong></h3>

<ul>
  <li>Abstracts physical properties to logical storage unit - file</li>
  <li>Files are usually organized into directories</li>
  <li>Access control determines who can access what</li>
</ul>

<blockquote>
  <p>[!tip]+ File system activities include</p>

  <ol>
    <li>
      <p>Creating and deleting files and directories</p>
    </li>
    <li>
      <p>Mapping files onto secondary storage</p>
    </li>
  </ol>
</blockquote>

<hr />

<h3 id="secondary-storage-management"><strong>Secondary Storage Management</strong></h3>

<blockquote>
  <p>[!tip]+ Secondary storage management activities</p>

  <ol>
    <li>Mounting and unmounting</li>
    <li>Free-space management</li>
    <li>Storage allocation</li>
    <li>Disk scheduling</li>
    <li>Partitioning</li>
    <li>Protection</li>
  </ol>
</blockquote>

<p>Disks usually are used to store data that do not fit in main memory or data that must be kept for a “long” period of time</p>

<ul>
  <li>Proper management is of central importance</li>
  <li>Entire speed of computer operation hinges on disk subsystem and its algorithms</li>
</ul>

<hr />

<h3 id="io-subsystem"><strong>I/O Subsystem</strong></h3>

<blockquote>
  <p>[!tip]+ I/O subsystem responsible for</p>

  <ul>
    <li>Memory management of I/O including buffering (storing data temporarily while it is being transferred), caching (storing parts of data in faster storage for performance), spooling (the overlapping of output of one job with input of other jobs)</li>
    <li>General device-driver interface</li>
    <li>Drivers for specific hardware devices</li>
  </ul>
</blockquote>

<p>One purpose of OS is to hide peculiarities of hardware devices from the user</p>

<hr />

<h3 id="protection-and-security"><strong>Protection and Security</strong></h3>

<p><strong>Protection</strong></p>

<ul>
  <li>Any mechanism for controlling access of processes or users to resources defined by the OS
<strong>Security</strong></li>
  <li>defense of the system against internal and external attacks 4
    <ul>
      <li>Huge range, including denial-of-service, worms, viruses, identity theft, theft of service</li>
    </ul>
  </li>
  <li>Systems generally first distinguish among users, to determine who can do what
    <ul>
      <li>User identities (user IDs, security IDs) include name and associated number, one per user</li>
      <li>Group identifier (group ID) allows set of users to be defined</li>
    </ul>
  </li>
</ul>

<hr />

        </content>
        <side style="font-size: 0.9em">
            <h3 style="margin-bottom: 1em">BackLink</h3>
            
            <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
                
                <div class="backlink-box">
                    <a class="internal-link"
                        href="/OperatingSystem/Operating-System-Introduction">Operating System Introduction</a><br>
                    <!-- <div style="font-size: 0.9em">[[Operating-System-Introduction]]
</div> -->
                </div>
                
                <div class="backlink-box">
                    <a class="internal-link"
                        href="/OperatingSystem/OperatingSystem">OperatingSystem</a><br>
                    <!-- <div style="font-size: 0.9em">[[OperatingSystem]]
</div> -->
                </div>
                
            </div>
            
        </side>
    </div>
</div>


</main>
</div>
<!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  var linkHistories = {};

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      if (!linkHistories[event.target.href]) {
        iframe.src = event.target.href
        iframe.onload = function() {
          tooltipContentHtml = ''
          tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
          tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

          tooltipContent.innerHTML = tooltipContentHtml
          linkHistories[event.target.href] = tooltipContentHtml

          tooltipWrapper.style.display = 'block';
          setTimeout(function() {
            tooltipWrapper.style.opacity = 1;
          }, 1)
        } 
      } else {
        tooltipContent.innerHTML = linkHistories[event.target.href]
        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }


      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

    document.querySelectorAll('.internal-link').forEach(setupListeners);
</script>

<script
  repo="yaleiyale/yaleiyale-comment" # 请建立你自己的评论仓库
  src="https://utteranc.es/client.js"
  issue-term="url"
  theme="github-light"
  crossorigin="anonymous"
  async="async"
></script>

  </div>
</div>



<link
  rel="stylesheet"
  href="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"
/>
<style>
  .katex-display>.katex {
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-all;
  }
</style>
<script
  src="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"
  defer="defer"
></script>
<script
 src="//cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
 defer="defer"
 onload='renderMathInElement(document.querySelector(".wrapper"), { delimiters: [{left: "$$", right: "$$", display: true}, { left: "$", right: "$", display: false }, {left: "\\(", right: "\\)", display: false}, {left: "\\[", right: "\\]", display: true}]})'
></script>




<style>
  pre.language-vega-lite,
  code.language-vega-lite {
    display: none;
  }
</style>
<script
  src="https://cdn.jsdelivr.net/combine/npm/vega@5.22.1,npm/vega-lite@5.2.0,npm/vega-embed@6.21.0"
  async="async"
  onload='
    for(let x of document.getElementsByClassName("language-vega-lite"))
      if(x.nodeName=="CODE")
      {
        let m = document.createElement("div");
        x.parentNode.insertAdjacentElement("beforebegin", m);
        vegaEmbed(m, JSON.parse(x.textContent));
      }'
></script>




<style>
  pre.language-mermaid,
  code.language-mermaid {
    display: none;
  }
  @media only screen {
    .mermaid {
      overflow: hidden hidden;
      max-width: 100%;
      max-height: 66.6vh;
    }
    .mermaid {
      overflow: auto auto;
    }
  }
</style>
<script
  src="https://cdn.jsdelivr.net/npm/mermaid@9.1.3/dist/mermaid.min.js"
  async="async"
  onload='
    for(let x of document.getElementsByClassName("language-mermaid"))
      if(x.nodeName=="CODE")
      {
        let m = document.createElement("div");
        m.classList.add("mermaid");
        m.textContent = x.textContent;
        x.parentNode.insertAdjacentElement("beforebegin", m);
      }'
></script>




<script type="text/javascript">
   var tags = {
    '[!note]': '<i class="fa-solid fa-pencil"></i>',
    '[!abstract]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!summary]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!tldr]': '<i class="fa-solid fa-clipboard-list"></i>',
    '[!info]': '<i class="fa-solid fa-circle-info"></i>',
    '[!todo]': '<i class="fa-solid fa-circle-info"></i>',
    '[!tip]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!hint]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!important]': '<i class="fa-solid fa-fire-flame-curved"></i>',
    '[!success]': '<i class="fa-solid fa-check"></i>',
    '[!check]': '<i class="fa-solid fa-check"></i>',
    '[!done]': '<i class="fa-solid fa-check"></i>',
    '[!question]': '<i class="fa-regular fa-circle-question"></i>',
    '[!help]': '<i class="fa-regular fa-circle-question"></i>',
    '[!faq]': '<i class="fa-regular fa-circle-question"></i>',
    '[!warning]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!caution]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!attention]': '<i class="fa-solid fa-triangle-exclamation"></i>',
    '[!failure]': '<i class="fa-solid fa-xmark"></i>',
    '[!fail]': '<i class="fa-solid fa-xmark"></i>',
    '[!missing]': '<i class="fa-solid fa-xmark"></i>',
    '[!danger]': '<i class="fa-solid fa-bolt"></i>',
    '[!error]': '<i class="fa-solid fa-bolt"></i>',
    '[!bug]': '<i class="fa-solid fa-bug"></i>',
    '[!example]': '<i class="fa-solid fa-list-ul"></i>',
    '[!quote]': '<i class="fa-solid fa-quote-right"></i>',
    '[!cite]': '<i class="fa-solid fa-quote-right"></i>'
  };
  var blocklist = document.querySelectorAll("blockquote");
  var blockCount = blocklist.length;
  var blockNow;
  for (var i = 0; i < blockCount; i++) {
    blockNow = blocklist[i];
    var find = false;
    for (var key in tags) {
      if (blockNow.innerHTML.indexOf(key) != -1) {
        blockNow.innerHTML = blockNow.innerHTML.replace(key, "");
        blockNow.childNodes[1].innerHTML = tags[key] + blockNow.childNodes[1].innerHTML;
        blocklist[i].innerHTML = blockNow.innerHTML;
        find = true;
        break;
      }
    }
    if(!find){
        blockNow.childNodes[1].innerHTML = '<i class="fa-solid fa-quote-left"></i><br>' + blockNow.childNodes[1].innerHTML;
        blocklist[i].innerHTML = blockNow.innerHTML;
      }
  }
</script>




<script>
  if (is_weixn_qq()) {
   window.location.href = "https://c.pc.qq.com/middle.html?pfurl="+window.location.href;
  }
  function is_weixn_qq(){
  var ua = navigator.userAgent;
  var isWeixin = !!/MicroMessenger/i.test(ua);
  var isQQ = !!/QQ\//i.test(ua);
  if(isWeixin||isQQ){
    return true;
   }
    return false;
  }
</script>




<style>
  pre .btn-pre-copy {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    position: absolute;
    top: 10px;
    right: 12px;
    font-size: 12px;
    line-height: 1;
    cursor: pointer;
    color: hsla(0, 0%, 54.9%, .8);
    transition: color .1s;
  }
</style>
<script>
  let preList = document.querySelectorAll("pre");
  for (let pre of preList) {
    let btn = document.createElement("div");
    pre.appendChild(btn);
    btn.className = "btn-pre-copy";
    btn.innerHTML = "复制";
   btn.onclick = function () {
     btn.innerHTML = "";
     toClip(pre.innerText);
      btn.innerHTML = "复制成功";
      setTimeout(() => {
       btn.innerHTML = "复制";
     }, 800);
    }
 }
  function toClip(text) {
    navigator.clipboard.writeText(text)
      .then(() => {
        console.log("Text copied to clipboard...");
      })
      .catch(err => {
        console.log('Something went wrong', err);
      });
  }
</script>




<script 
  src="https://cdn.jsdelivr.net/gh/yaleiyale/lamu-leimu-button@master/lamu-leimu.min.js"
></script>



    
  </div>
  
  <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  
  
</body>

</html>

